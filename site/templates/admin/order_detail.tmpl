<:wrap admin/base.tmpl title => [concatenate "Order " [order id] " details"]:> 
<h1>Shop Administration</h1>
<p>| <a href="/cgi-bin/admin/menu.pl">Admin menu</a> |
<a href="<:adminurl shopadmin:>">Manage catalogs</a> |
<a href="<:adminurl shopadmin order_list 1:>">Manage orders</a> |
<a href="<:adminurl shopadmin order_list 1 template order_list_unfilled:>">Unfilled 
  orders</a> |
<a href="<:adminurl shopadmin order_list 1 template order_list_filled:>">Filled 
  orders</a> |
<:ifSiteuser id:><a href="<:adminurl siteusers a_edit 1 id [siteuser id]:>">Edit Member</a> |
<a href="<:adminurl siteusers a_edit=1 id [siteuser id] _t orders:>">Other member orders</a> |<:or:><:eif:>
</p>
<:ifMessage:><div class="message"><:message:></div><:or:><:eif:>
<h2>Order details - No: #<:order id:></h2>
<:ifOrder complete:><:or:><p>This order is incomplete and should not be filled.</p><:eif:>
<table class="editform orderdetail_head">
  <tr> 
    <th class="col_head">E-mail:</th>
    <td class="col_value"><a href="mailto:<:order emailAddress:>"><:order emailAddress:></a></td>
    <td rowspan="3">&nbsp;</td>
    <th class="col_head">Phone:</th>
    <td class="col_value"><:order telephone:></td>
  </tr>
  <tr> 
    <th class="col_head">Date:</th>
    <td class="col_value"><:date order orderDate:></td>
    <th class="col_head">Mobile:</th>
    <td class="col_value"><:order delivMobile:></td>
  </tr>
  <tr> 
    <th class="col_head">Delivery:</th>
    <td class="col_value"><:order delivFirstName:> <:order delivLastName:>
      <:ifOrder delivOrganization:><br /><:order delivOrganization:><:or:><:eif:>
      <br /><:order delivStreet:>
      <:ifOrder delivStreet2:><br /><:order delivStreet2:><:or:><:eif:>
      <br /><:order delivSuburb:> <:order delivState:> <:order delivPostCode:>
      <br /><:order delivCountry:></td>
    <th class="col_head">Billing:</th>
    <td class="col_value">
      <:order billFirstName:> <:order billLastName:>
      <:ifOrder billOrganization:><br /><:order billOrganization:><:eif:>
      <br /><:order billStreet:>
      <:ifOrder billStreet2:><br /><:order billStreet2:><:or:><:eif:>
      <br /><:order billSuburb:> <:order billState:> <:order billPostCode:>
      <br /><:order billCountry:>
    </td>
  </tr>
  <:include custom/order_detail.include optional:><:include admin/include/custom/order_detail_custom.tmpl optional:><:include admin/include/order_detail_custom.tmpl optional:>
</table>

<br />
      <table class="editform orderdetail">
        <tr> 
          <th class="col_description">Description</th>
          <th class="col_units">Units</th>
          <th class="col_unitprice">Unit Price</th>
          <th class="col_extension">Extension</th>
          <th class="col_unit_wsale">Unit Wsale</th>
          <th class="col_ext_wsale">Ext Wsale</th>
          <th class="col_unit_gst">Unit GST</th>
          <th class="col_ext_gst">Ext GST</th>
</tr>
<:iterator begin items:>
        <tr> 
          <td class="col_description"><:ifOr [ifEq [item productId] -1] [ifEq [product id] ""]:><:item title:> (product deleted)<:or:><a href="<:adminurl shopadmin product_detail 1 id [product id]:>"><:product
            title:></a><:eif:> <:options:></td>
          <td class="col_units"><:item units:></td>
          <td class="col_unitprice"><:money item price:></td>
          <td class="col_extension"><:extension price:></td>
          <td class="col_unit_wsale"><:money item wholesalePrice:></td>
          <td class="col_ext_wsale"><:extension wholesalePrice:></td>
          <td class="col_unit_gst"><:money item gst:></td>
          <td class="col_ext_gst"><:extension gst:></td>
</tr>
<:iterator end items:>
<:if Cfg shop shipping:>
<:if Order shipping_name:>

        <tr> 
          <td colspan="3" class="col_contact">
<:if Eq [order shipping_name] "contact":>
Contact customer to make shipping arrangements
<:or Eq:>
Shipping via <:order shipping_method:>
<:eif Eq:>, 
	        <form method="post" action="<:adminurl shopadmin a_order_save 1:>">
    <input type="hidden" name="id" value="<:order id:>" />
    <:csrfp shop_order_save hidden:>
    <label>tracking code: <input type="text" name="freight_tracking" value="<:order freight_tracking:>" /></label>
    <input type="submit" name="a_order_save" value="Save" />
    </form>

</td>
          <td class="col_extension"><:money order shipping_cost:></td>
          <td>&nbsp;</td>
          <td class="col_ext_wsale"></td>
          <td>&nbsp;</td>
          <td class="col_ext_gst"></td>
</tr>
<:or Order:><:eif Order:>
<:or Cfg:>
<:eif Cfg:>
        <tr> 
          <td colspan="3" class="col_total">Total:</td>
          <td class="col_extension total"><:money order total:></td>
          <td>&nbsp;</td>
          <td class="col_ext_wsale total"><:money order wholesaleTotal:></td>
          <td>&nbsp;</td>
          <td class="col_ext_gst total"><:money order gst:></td>
</tr>
<:if Cfg shop shipping:><:or Cfg:>
<tr>
  <td colspan="3">
    <form method="post" action="<:adminurl shopadmin a_order_save 1:>">
    <input type="hidden" name="id" value="<:order id:>" />
    <:csrfp shop_order_save hidden:>
    <label>Shipping method: <:shipping_method_select:></label>
    <label>tracking code: <input type="text" name="freight_tracking" value="<:order freight_tracking:>" /></label>
    <input type="submit" name="a_order_save" value="Save" />
    </form>
  </td>
  <td colspan="5"></td>
</tr>
<:eif Cfg:>
</table>
<p>Order progress: <:stage_description:> <a href="#" onclick="document.getElementById('update_stage').style.display='block'; this.style.display='none'; return false;">update</a></p>

<form id="update_stage" action="<:adminurl shopadmin:>" style="display: none" method="post">
  <input type="hidden" name="id" value="<:order id:>" />
  <:csrfp shop_order_save hidden:>
  <:stage_select:>
  <label>Log note: <input type="text" name="stage_note" size="40" /> (optional)</label>
  <input type="submit" name="a_order_save" value="Save" />
</form>

<:switch:>
<:case Eq [order paidFor] "0":>
<p>This order hasn't been paid</p>
<p>If the customer has paid by cheque, transfer, etc, you can <a href="<:adminurl shopadmin a_order_paid 1 id [order id]:>">mark this order paid</a></p>
<:case order ccOnline:>
<p>This was processed as an online credit card transaction.</p>
<:if Order ccSuccess:>
<p>This transaction was <b>SUCCESSFUL</b>.</p>
<table>
<tr><th>Receipt Number:</th><td><:order ccReceipt:></td></tr>
<:ifOrder ccTranId:>
<tr><th>Transaction Id:</th><td><:order ccTranId:></td></tr>
<:or:><:eif:>
</table>
<:or Order:>
<p>This transaction <b>FAILED</b>.</p>
<table>
<tr><th>Status:</th><td><:order ccStatus:></td>
<tr><th>Error:</th><td><:order ccStatusText:></td>
<:ifOrder ccStatus2:>
<tr><th>More status</th><td><:order ccStatus2:></td>
<:or:><:eif:>
</table>
<:eif Order:>
<:case Eq [order paymentType] "0":><p>Payment made by credit card.  Credit card details can be found in the encrypted email you received when the customer made the order.</p>
<:case Eq [order paymentType] "1":><p>Payment will be made by cheque.</p>
<:case Eq [order paymentType] "2":><p>Contact the customer to arrange for payment.</p>
<:case Eq [order paymentType] "3":><p>Paid manually (staff marked this order paid) - you can <a href="<:adminurl shopadmin a_order_unpaid 1 id [order id]:>">unmark it</a></p>
<:case Eq [order paymentType] "4":><p>Paid via PayPal, transaction id <:order paypal_tran_id:><:ifUserCan bse_shop_order_refund_paypal:> <a href="<:adminurl shopadmin a_paypal_refund 1 id [order id]:>">Refund</a><:or:><:eif:></p>
<:endswitch:>
<:include custom/order_detail_payment.include optional:>
<:if Order filled:>
<p>This order was filled on <:date order whenFilled:> by <:order whoFilled:>.</p>
<:or Order:>
<:ifOrder complete:>
<p>This order hasn't been filled yet.  <a href="<:adminurl shopadmin id [order id] order_filled Yep filled 1 detail 1:>">Mark order filled</a>.</p><:or:><:eif:>
<:eif Order:>
<:if Order instructions:>
<p style="white-space: pre-wrap;"><:order instructions:></p>
<:or Order:><:eif Order:>

<table class="editform" id="auditlog">
<:include admin/include/audithead.tmpl:>
<:iterator begin auditlog object_id [order id] object_type BSE::TB::Order:>
<:include admin/include/auditentry.tmpl:>
<:iterator end auditlog:>
</table>
