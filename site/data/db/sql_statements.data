--
name: bse_siteuserSeminarBookingsDetail
sql_statement: <<SQL
select ar.*, pr.*, se.*, ss.*, sb.*,
      lo.description as loc_description,
      lo.room as loc_room,
      lo.street1 as loc_street1,
      lo.street2 as loc_street2,
      lo.suburb as loc_suburb,
      lo.state as loc_state,
      lo.country as loc_country,
      lo.postcode as loc_postcode,
      lo.public_notes as loc_public_notes,
      lo.bookings_name as loc_bookings_name,
      lo.bookings_phone as loc_bookings_phone,
      lo.bookings_fax as loc_bookings_fax,
      lo.bookings_url as loc_bookings_url,
      sb.id as booking_id
  from article ar, product pr, bse_seminars se, bse_seminar_sessions ss,
       bse_locations lo, bse_seminar_bookings sb
  where sb.siteuser_id = ?
    and sb.session_id = ss.id
    and ss.seminar_id = ar.id
    and ss.seminar_id = pr.articleId
    and ss.seminar_id = se.seminar_id
    and ss.location_id = lo.id
SQL

name: bse_locationSessionDetail
sql_statement: <<SQL
select ar.*, pr.*, se.*, ss.*,
   ss.id as session_id
  from article ar, product pr, bse_seminars se, bse_seminar_sessions ss
  where ss.location_id = ?
    and ss.seminar_id = ar.id
    and ss.seminar_id = pr.articleId
    and ss.seminar_id = se.seminar_id
  order by ss.when_at desc
SQL

name: getSeminarBookingBySession_idAndSiteuser_id
sql_statement: <<SQL
select * from bse_seminar_bookings
  where session_id = ? and siteuser_id = ?
SQL

name: bse_cancelSessionBookingForUser
sql_statement: <<SQL
delete from bse_seminar_bookings
  where session_id = ? and siteuser_id = ?
SQL

name: bse_updateSessionBookingForUser
sql_statement: <<SQL
update bse_seminar_bookings
  set roll_present = ?, options = ?, customer_instructions = ?, 
    support_notes = ?
  where session_id = ? and siteuser_id = ?
SQL

name: getSeminarBookingByPkey
sql_statement: <<SQL
select * from bse_seminar_bookings where id = ?
SQL

name: replaceSeminarBooking
sql_statement: <<SQL
replace bse_seminar_bookings values(?,?,?,?,?,?,?)
SQL

name: SeminarSessions.sessionsUnbookedByUser
sql_statement: <<SQL
select ss.* from bse_seminar_sessions ss left join bse_seminar_bookings sb
  on ss.id = sb.session_id and sb.siteuser_id = ?
where ss.seminar_id = ? and sb.siteuser_id is null
SQL

name: seminarSessionInfoUnbooked
sql_statement: <<SQL
select ss.*, lo.*, ss.id as session_id 
  from bse_locations lo 
  right join bse_seminar_sessions ss on lo.id = ss.location_id
  left join bse_seminar_bookings sb
  on ss.id = sb.session_id and sb.siteuser_id = ?
where ss.seminar_id = ? and sb.siteuser_id is null and lo.id = ss.location_id
SQL

name: AdminGroups.forUser
sql_statement: <<SQL
select ab.*, ag.*
  from admin_base ab, admin_groups ag, admin_membership am
where am.user_id = ? and am.group_id = ab.id and ab.id = ag.base_id
SQL

name: siteuserAddFileCategory
sql_statement: <<SQL
insert into bse_file_subscriptions(siteuser_id, category)
 values(?, ?)
SQL

name: siteuserRemoveFileCategory
sql_statement: <<SQL
delete from bse_file_subscriptions where siteuser_id = ? and category = ?
SQL

name: siteuserSubscribedFileCategories
sql_statement: <<SQL
select category
from bse_file_subscriptions
where siteuser_id = ?
SQL

name: OwnedFiles.userVisibleGroupFiles
sql_statement: <<SQL
select of.*
from bse_owned_files of, bse_siteuser_membership sm
where sm.siteuser_id = ?
  and sm.group_id = of.owner_id
  and of.owner_type = 'G'
SQL

name: bseDownloadLogAge
sql_statement: <<SQL
delete from bse_file_access_log
 where when_at < date_sub(now(), interval ? day)
SQL

name: bseClearOldFileNotifications
sql_statement: <<SQL
delete from bse_file_notifies
  where when_at < date_sub(now(), interval ? day)
SQL

name: bseAddOwnedFileNotification
sql_statement: <<SQL
insert into bse_file_notifies(file_id, owner_type, owner_id, when_at)
  values(?, ?, ?, now())
SQL

name: bseAddOwnedFileNotificationTime
sql_statement: <<SQL
insert into bse_file_notifies(file_id, owner_type, owner_id, when_at)
  values(?, ?, ?, ?)
SQL

name: baseClearOldFileNotifications
sql_statement: <<SQL
delete from bse_file_notifies
 where when_at < date_sub(now(), interval ? day)
SQL

name: bseDeleteFileNotification
sql_statement: <<SQL
delete from bse_file_notifies where id = ?
SQL

name: bseExpandGroupFileNotification
sql_statement: <<SQL
insert into bse_file_notifies(file_id, owner_type, owner_id, when_at)
select fn.file_id, 'U', sm.siteuser_id, fn.when_at
from bse_file_notifies fn,
     bse_siteuser_membership sm,
     bse_owned_files fi,
     bse_file_subscriptions fs
where fn.id = ?
  and fi.id = fn.file_id
  and fn.owner_id = sm.group_id
  and fs.siteuser_id = fs.siteuser_id
  and fs.category = fi.category;
SQL

name: bseNotifyFileGroupEntries
sql_statement: <<SQL
select * from bse_file_notifies
where owner_type = 'G'
order by when_at
limit 100
SQL

name: bseFileNotifyUsers
sql_statement: <<SQL
select distinct owner_id as id
from bse_file_notifies
where owner_type = 'U'
SQL

name: bseFileNotifyUserEntries
sql_statement: <<SQL
select *
from bse_file_notifies
where owner_type = 'U'
  and owner_id = ?
SQL

name: BackgroundTasks
sql_statement: select * from bse_background_tasks

name: bseClearArticleFileMetadata
sql_statement: <<SQL
delete from bse_article_file_meta
where file_id = ?
SQL

name: bseClearArticleFileAppMetadata
sql_statement: <<SQL
delete from bse_article_file_meta
where file_id = ? and appdata <> 0
SQL

name: bseClearArticleFileSysMetadata
sql_statement: <<SQL
delete from bse_article_file_meta
where file_id = ? and appdata = 0
SQL

name: bseDeleteArticleFileMetaByName
sql_statement: <<SQL
delete from bse_article_file_meta
where file_id = ? and name = ?
SQL

name: bseArticleKidSummary
sql_statement: <<SQL
select id, title, level, listed from article where parentid = ?
order by displayOrder desc
SQL

name: bseChildOrder
sql_statement: <<SQL
select id, displayOrder
from article
where parentid = ?
SQL

name: bseStepchildOrder
sql_statement: <<SQL
select childId as id, parentDisplayOrder as displayOrder, id as step_id
from other_parents
where parentId = ?
SQL

name: bseSetStepOrder
sql_statement: <<SQL
update other_parents
set parentDisplayOrder = ?
where id = ?
SQL

name: bseSetArticleOrder
sql_statement: <<SQL
update article
set displayOrder = ?
where id = ?
SQL
