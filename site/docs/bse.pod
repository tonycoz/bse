=head1 NAME

BSE - an engine for simple magazine style WWW sites.

=head1 DESCRIPTION

BSE is an engine for creating simple magazine type web sites.

Maybe I'll add some other bits here.

=head1 CHANGES

=head2 0.15_40

=over

=item *

correct the closing search highlight to </b> instead of <b>

=item *

forms will now process file upload fields and send the files as
attachments to the email.  The attachments are not encrypted if the
form has encryption enabled.  Upload fields are not supportted for
sending to the database.

=item *

forms now only have 3 encryption settings, encrypt, crypt_passphrase
and crypt_signing_id.  All other values are now set from the BSE shop
defaults.

=item *

form emails now use BSE::ComposeMail, which will be extended to
support HTML emails one day.  BSE::ComposeMail was extended to support
encryption and attachments.

=item *

bump to 0.15_40

=back

=head2 0.15_39

=over

=item *

added bse_timeout.pl test script.  This can be used to test if a
hosting provider sets time limits on requests.  This script should be
removed in production.

=item *

fix dynamic tags on some user.pl generated pages

=item *

doclink[] tag was causing a 500 error.

=item *

the ifCurrentPage tag on the search results templae is not
ifCurrentSearchPage, due to a conflict with ifCurrentPage on article
templates.

=item *

basic ajax support on the search page.  This has some known problems.
To enable set [basic].ajax to 1.  This is experimental.

=item *

ability to highlight any result article field with highlight_result tag.

=item *

excerpting of search result file notes

=item *

customization of search result term highlighting

=item *

added I<fieldname>_matched field to the matchfile tag to be able to
detect if a given file field matched the search terms.

=item *

bump to 0.15_39

=back

=head2 0.15_38

=over

=item *

remove comment about fixed tiff.c in thumbnails.pod, this has been
fixed

=item *

add registration notifications emails feature, enable by setting [site
users].notify_register to some true value (like 1)

=item *

added site/docs/siteusers.pod with a more introductory documentation
of the registration emails.

=item *

bump to 0.15_38

=back

=head2 0.15_37

=over

=item *

add match all option to searching

=item *

sort articles with the same search score by title

=item *

accept an r parameter for fmail.pl form submission to refresh to a
page other than the default done page.

=item *

fix the default template name for the embedded report tags.

=item *

added dynamic tag ifUserMemberOf which checks if the current user is a
member of the named group.  Supply a leading * to name query groups.

=item *

added a name or identifier field to the article_files table, and
administration tools to manage it.

=item *

re-worked the formatting API for easier extension

=item *

added filelink[] body text tag

=item *

removed some old commented code from Generate.pm

=item *

bump to 0.15_37

=back

=head2 0.15_36

=over

=item *

add search scores to the result tag

=item *

add the ability to require terms to match for a search

=item *

add the ability to exclude results that match a term

=item *

add bonuses to scores for results where the term matches more than one
field.

=item *

searching and indexing processing have been moved into configurable
modules, so we can add other search engines (a swish-e engine would be
nice)

=item *

bump to 0.15_36 for release

=back

=head2 0.15_35

=over

=item *

in some cases the Articles module wasn't being loaded as needed

=item *

access checks are no longer done on iterators when an article is
displayed in admin mode.

=item *

prevent undefined value warnings from fmail.pl when no validation
rules are set for a field.

=item *

prevent undefined value warnings from validation when no rules are set
for a field.

=item *

add userupdate.pl for uploading member updates as text files

=item *

bump to 0.15_35

=back

=head2 0.15_34

=over

=item *

added dynamic iterators, listed each here as iterator name/item name.

Global: dynlevel1s/dynlevel1, dynlevel2s/dynlevel2,
dynlevel3s/dynlevel3, dynallkids_of/dynofallkid,
dynchildren_of/dynofchild.

Article pages: dynallkids/dynallkid, dynchildren/dynchild,
dynstepparents/dynstepparent.

=item *

added cgi-bin/admin/bse_modules.pl script to check that modules used
by BSE are installed.  This should probably be removed once BSE is
installed and running.

=item *

search results now only include accessible articles by default.

=item *

the product tag no long warns when you attempt to use an undef (NULL)
value from the product.

=item *

removed method=post from some display forms used to simply display
data.

=back

=head2 0.15_33

=over

=item *

fill in the ccNumberHash when not doing online processing (this was
lost when online processing was added)

=item *

fill in ccTranId with an empty string if the cc provider doesn't give
us one.

=item *

add SecurePay XML credit card driver

=item *

briefly document the credit card driver interface.

=item *

the stepparents iterator now only lists "visible" articles.

=item *

userlist.pl now does logon and access checks - make sure
bse_siteuser_dump is allowed for appropriate users.

=item *

userlist.pl now replaces newlines in the member data with spaces to
prevent problems importing the data.

=item *

changed userlist.pl to check for bse_siteuser_export instead of
bse_siteuser_dump.

=item *

userlist.pl can now dump a range of logons, specified with minlogon
and maxlogon.  If the field is missing or empty then the range
includes the first or last by logon as appropriate.

=item *

added periodic API to DevHelp::Payments::SecurePayXML.  This API isn't
used by BSE.

=item *

modified userlist.pl so it can search for id or userId (logon)

=item *

changed the attributes of the dummy user for subscriptions (from
Adrian Oldham)

=item *

menu.pl was using the wrong help icon

=item *

the report tag used by BSE itself conflicts with the report
informational tag used in reports themselves.  Added the subreport tag
so you can embed reports into other reports in the context of BSE.

=back

=head2 0.15_32

=over

=item *

added gimages iterator

=item *

you can now use the [tag parms] syntax in the imagen tag 

=item *

check user has access to an article before allowing file
downloads. (#531)

=item *

shop emailed order encryption options can now all be set in the
configuration file.

=item *

the credit card owner and type were not being stored in the order
record. (#533)

=item *

optionally request the card type when requesting credit card
information.

=item *

the affiliate.pl a_set action now allows you to configure extra
cookies to be set.

=back

=head2 0.15_31

=over

=item *

prevent a 500 error when the user doesn't have access to create
articles at a given level.

=item *

apply Adrian's set_errors_to_from patch

=item *

handle div/blockquote/address blocks a bit better.

=item *

ported the OO validation changes across

=item *

allow image[...|padding] to format padding as padding when there's no
spaces in padding.

=item *

have bse_I<permission> permission non-rights checks (eg. checking for
no children on edit_delete_article) do the same checks as for
I<permission>

=item *

added some debugging output to the ifUserCan tag handler

=item *

patch from Adrian Oldham: add metaDescription and metaKeywords article
fields.

=item *

patch from Adrian Oldham: fix quotes around template tag attributes,
and valueless tags.

=item *

update t/t20gen.t and t/t21gencat.t to allow for the new fields

=item *

fix shell syntax problem in Makefile

=item *

implement popimage[] tag.

=item *

patch from Adrian Oldham: add missing documentation for article fields
in Generate::Article.

=item *

word-wrap some lines added by above

=item *

copy same field documentation to templates.pod

=item *

enable admin security tags when pages are displayed in admin mode
(ie. by admin.pl)

=back

=head2 0.15_30

=over

=item *

stop BSE::Session from keeping a reference to the session hash so it
can be cleaned up properly.

=item *

parent validation for catalogs now correctly uses eq instead of ==
when testing the generator type.

=item *

the apache page handler now preloads more modules.

=item *

fmail.pl can now be configured to send form data to a database table
as well as or instead of sending an email.

=back

=head2 0.15_29

=over

=item *

improved mod_perl compatibility - note: you cannot run more than one
instance of BSE under mod_perl, and most scripts shouldn't be expected
to work.

=item *

added page.fcgi, a FastCGI version of page.pl.  See dynamic.pod for
information on configuring this.

=item *

added BSE::Handler::Page, a mod_perl handler for page.pl.  This should
have lower initial request times than using page.pl under
Apache::Registry.

=item *

we no longer attempt to regenerate articles with an empty link

=item *

poplink[], link[], doclink[], popdoclink[] now have the class
attribute set based on the type of link.  By default this class is the
same as the name of the tag, but can be configured in [body class].

=item *

body text generated HTML now has the class of generated p tags set
based on the [body class] config section.  By default no class is set.

=item *

added formlink[] and popformlink[] tags to link to fmail.pl forms.
You can set the title attribute in the config file for the form to set
the default text.  The class attribute for these can be configured in
[body class].

=back

=head2 0.15_28

=over

=item *

deleting an article now deletes the generated page or cached page,
depending on the article type.

=item *

changing an article from dynamic to static now deletes the cached
page. (going the other way deletes since 0.15_27.)

=item *

deleting an article with files attached now deletes the file records
and file content.

=item *

code processing the deletion of an article has been slightly
reorganized. (moved from the edit code to the article object code)

=item *

code processing the deletion of an article file has been slightly
reorganized. (moved from the edit code to the article file code)

=item *

the done template for fmail.pl can now iterate over the selected
values as the email template does.

=item *

added site/docs/dynamic.(pod|html), which documents BSE's dynamic page
generation.

=item *

documented [template types] bse.cfg section

=back

=head2 0.15_27

=over

=item *

the article link column has been expanded to 255 characters

=item *

children are no longer always dynamic if their parent is.  They must
now either inherit access controls or have the force_dynamic flag set
in the article or in the config file to become dynamic (but see below.)

=item *

added the "Descendants inherit Always Dynamic" flag.  If this and the
"Always dynamic" flag is set for an article then all descendants will
be dynamic.

=item *

the doclink[] and popdoclink[] body text tags now include a HTML title
attribute in the <a ...> tag.

=item *

children are now correctly regenerated when their dynamic parent is
saved.

=item *

when an article turns from static to dynamic the static content is now
removed.

=back

=head2 0.15_26

=over

=item *

added a session bookings page

=item *

the url generated by the doclink[] and popdoclink[] body text tags are
now properly HTML escaped

=item *

the cached dynamic status of a newly created article is now set
correctly.

=item *

fmail.pl forms now collect field defaults by, urr, default.

=item *

the ifValueSet fmail.pl tag now checks the field default for the
initial display of a form.

=item *

the shop now skips the payment page if the order total is 0.

=item *

ordering a non-seminar product no longer causes a 500 error on final
processing of the order.

=item *

the final order page wasn't processing dynamic page tags

=back

=head2 0.15_25

=over

=item *

if a conditional tag isn't defined when during tag replacement,
previously defined tags in the true and false parts of the tag were
not replaced.  They are now.

=item *

page.pl now accepts the article id via the page parameter instead of
id.  You will need to edit and save any existing articles to update
their link fields with the new URL.

=item *

added bseaddimages.pl, a tool for adding image to an article on a
remote BSE.  The -u and -p options are currently untested. YMMV.

=item *

the ofchild, ofallkid, and inline tags now perform HTML escaping.

=item *

many BSE::UserReg error handlers were calling the display functions
with the old argument list, cause 500 errors when attempting to
display errors.

=item *

added ifAccessControlled static article tag

=back

=head2 0.15_24

=over

=item *

if you did a search in a selected section, the search results page
would leave the sections drop down back on "All Sections".  It now
correctly uses the previous section.

=item *

added a notes field to files attached to articles.  This is indexed by
the search engine.  Note that the indexing of the description is split
into the indexing of the displayName and description.

=item *

admin.pl now applies the dynamic page tags for dynamic articles.

=item *

fmail.pl's a_done target now uses the dynamic page tags.

=item *

search.pl now displays matching files (with the same limitations as
current match displays)

=item *

removed from debug output

=back

=head2 0.15_23

=over

=item *

added [shop].secureurl_articles option.  Patch by Adrian Oldham
(http://www.visualthought.com.au/)

=item *

pregenerated templates used by various scripts are now generated as if
they were dynamic articles, and the various scripts now make the
dynamic article tags available.  This is a complex change, so it may
have introduced some problems.

=item *

the sidebar logon panel has been updated to generate serverside when
the containing page is dynamic.

=item *

the t21gencat.t test script wasn't cleaning up properly after itself,
leaving the database in an inconsistent state.

=item *

fmail.pl forms are now filled from the currently logged on siteuser by
default.  The field names must correspond to the siteuser field named
for this to happen.  Note: custom defquery_base variants will need to
be updated to support this.

=item *

user.pl now attempts to display the userpage by default, instead of
the logon form.

=item *

the images iterator (on articles) now accepts various options to
filter the images iterated over.  See templates.pod for details.

=item *

the ifImages conditions (on articles) now accepts various options to
filter the images tested for.  See templates.pod for details.

=back

=head2 0.15_22

=over

=item *

if siteuser groups were required on a non-top level article, and the
user was not logged on, a 500 error would occur, instead of displaying
the logon page.

=item *

you can now set require_logon to non-zero for an fmail.pl form to
require the user to logon before displaying/submitting the form.  The
message displayed on the logon form can be customized, see
L</formmail.pod> for details.

=item *

the submit button on the defquery_base page had an empty value unless
the submit text was configured

=item *

moved the security check code out of BSE::UI::Page to BSE::Request to
make it more generally available.

=item *

image.pl now checks the user has access to the article before
displaying the image

=item *

saving a dynamic catalog would cause a 500 error.

=back

=head2 0.15_21

=over

=item *

added image.pl, intended for image display popups, accepts article id
parameter as I<id> and either an image id as I<imid> or an image name
as I<imname>.

=item *

you can now add siteuser groups required to view an article.  Adding
such access requirements forces an article to be generated
dynamically.

=item *

added sql_statements table, used for BSE extensions.

=item *

error.tmpl is now generated correctly from error_base.tmpl

=item *

siteuser group management actions now correctly refresh to the URL
supplied in the r parameter, if any.

=item *

minor patch to fix the error message displayed when attempting to save
over a modified article (midnight to 1am times now displayed
correctly) (supplied by Adrian Oldham)

=item *

added image_index tag to the display article tags

=back

=head2 0.15_20

Applied a patch from Adrian Oldham:

=over

=item *

date fields in the articles created by initial.pl are now set to the
date initial.pl is run rather than some date in the past.

=item *

simple (optional) protection against saving over pages modified by
someone else.

=item *

the search engine now indexs the author and pageTitle fields.  The
file_description is now indexed by default (previously you needed to
configure it)

=item *

added: document [editor].check_modified in config.pod.

=back

=head2 0.15_19

Minor release so I can patch some other things.

=over

=item *

renamed the new level1_col tag to level1_byname to prevent a conflict
with the older level1_col tag from the level1_cols iterator.

=item *

pages can now be generated dynamically, though I'm still working on
the UI side of making them flagged dynamic.  Structure exists to make
it possible to add extra dynamic tags on per article type basis, but
isn't used yet.

=item *

you can create site user groups, and put users in them, and delete
them.

=back

=head2 0.15_18

=over

=item *

added loaddata.pl tool to util directory for use in loading up tables
with data

=item *

full_access permission now includes all bse_ permissions

=item *

config file entries can now use "here-docs", for example:

  [some section]
  key=<<EOD
  some data
  EOD

this is especially useful for sql statements for reports

=item *

fixed the dynreport tag, a parameter wasn't being passed to the
handler.

=item *

added level1_col and level1_sum tags to the report tool.

  <:level1_col column_name:>

will extract the column of the given name.

  <:level1_sum column_name:>

will return the sum of that column for the result set.

=item *

you can now set a debug flag for a report.  This doesn't produce much
information yet.

=item *

added builtin C<pastdate> rule to the validation module.

=back

=head2 0.15_17

Iterim release with subscriptions work.

=over

=item *

added newsletter subscription filters to subs.pl.

=item *

admin/users/edit.tmpl now has an optional include so we can use custom
fields without modifying it.

=back

=head2 0.15_16

Adds the report changes except for control-break reports.

I'm going to workaround control-break reports for now, it was taking
way too long.  I'll implement them at a future date when there's no
time pressure.

=over

=item *

implemented the <:report ...:> and <:dynreport ...:> tags

=item *

added access controls to reports

=back

=head2 0.15_15

=over

=item *

seminars can now be added to orders (if the user is logged on and
isn't already booked)

=item *

added a_location target to shop.pl to display location information to
end-users (intended for use as a pop-up)

=item *

removed old commented code from shop.pl

=item *

subs.pl now has normal admin tags on the newsletter list, including
correcting the help tag.

=item *

the validation of the article parent id was incorrect, causing
problems when saving existing articles.  Corrected the validation.

=item *

parsing and handling of the default value for the release and expire
fields were reversed.

=item *

seminar display templates are now under the seminars directory

=item *

seminar display templates now have access to locations, location
sessions and sessions iterators.

=item *

cart, checkoutnew and checkoutfinal templates now have access to
per-item session and location tags

=item *

you can now add a user as a seminar attendee, without them having made
an order.

=item *

DevHelp::Date had been changed to try to import its import method from
Exporter, but this doesn't work on older perls.  Reverted to subclass
Exporter.

=item *

upgrade_mysql.pl wasn't correctly checking the entered number, and
would perform the upgrade even if the incorrect value was entered.

=item *

upgrade_mysql.pl now treats C< varchar(...) binary > as if it were C<
varbinary(...) > and no longer treats this as a column type change
(unless the size changes)

=back

This is a development release, not intended for production.

=head2 0.15_14

=over

=item *

site/htdocs/images/trans_pixel.gif is now transparent again

=item *

search.pl would produce a 500 error if the search string contained
regexp metacharacters (#502)

=item *

search.pl was only searching for the first search term

=item *

the shopadmin.pl product list wasn't listing seminars

=item *

field configuration for the location pages was being ignored

=item *

add.pl now generally accepts m or message for the message parameter,
and can accept multiple messages.

=item *

functionality added to add, edit, delete, and take roll for sessions

=back

=head2 0.15_13

This is a development release, not intended for production.

=over

=item *

location maintenance at the basic level is in, accessible via
http://example.com/cgi-bin/admin/admin_seminar.pl

=item *

you can create seminars, though there's no sessions or related data
yet.

=item *

the generator field in articles has been expanded in size, so
BSE::Generate::Whatever will fit in.

=item *

orders now accept delivery and billing organization names, and a
second street line for the delivery and billing addresses

=item *

members can now have a second street address line in their billing and
delivery addresses.  They can also have a billing organization.

=item *

the release and expiry dates for articles when creating a new article
seem to have been handled incorrectly for a long time.  We now
properly parse them when adding a new article (or product, etc)

=item *

in some cases the date tage %z value would be omitted under Linux.
I'm not sure why this was happening, and the fix is pretty empirical.

=item *

we now attempt to handle nested non-tag [] when removing tags from
body text.

=item *

t/t40images.t now uses the links() method instead of the internal
extract_links() method.  (this is part of the test suite and doesn't
have an effect on most users)

=item *

articles now store their creation date, the user who created them the
user who last modified them. (implemented by Adrian Oldham)

=item *

articles now have author and pageTitle attributes.  The pageTitle
attribute overrides the value of the title field in the HTML header
title tag.  Currently these are not indexed or searched by the search
engine. (implemented by Adrian Oldham)

=item *

error messages for invalid image identifiers have been changed
(implemented by Adrian Oldham)

=item *

previously the parentid wasn't being properly validated when adding a
new article, possible causing a 500 error.  We validate the value and
report an error on invalid values now.

=back

=head2 0.15_12

=over

=item *

affiliate.pl can now set a configured cookie to the value of the
affiliate id.  See [affiliate].set_cookie in config.pod.

=item *

added template sidebar/afflink.tmpl that can use such a cookie

=back

=head2 0.15_11

=over

=item *

fmail.pl's values_select tag now sets the id attribute to the name of
the field.

=item *

famil.pl now has the remote_addr tag available when composing the
email

=item *

the capitalise tag now attempts to capitalize words like "don't"
correctly.

=item *

a validation rule of:

  nomatch=0

would be ignored

=item *

fmail.pl added to the smoke test script

=back

=head2 0.15_10

=over

=item *

the pgp content type header for encrypted fmail emails is now added
only if configured to do so with the crypt_content_type option.

=item *

the required_if validation option can now be used from the validation
configuration.

=item *

empty values when specifying values in the form:

  fieldname_values=value1=name1;value2=name2

can now be specified

=item *

you can now specify a prefix for values specified via section name,
for example:

  fieldname_values=some section:prefix

  [some section]
  prefix=None Selected
  prefix1=One
  prefix2=Two

where the values/names for the select will be:

  ""   None selected
  "1"  One
  "2"  Two

=back

=head2 0.15_09

=over

=item *

added formcfg tag to the fmail templates, this tag allows access to
other values in the form's configuration file section.

=item *

added field_config to the fmail form configuration file section.  This
can list extra values to be retrieved from the config file for each
field.

=item *

DevHelp::Validate depends on DevHelp::Date, which wasn't included.

=item *

BSE::UI::Formmail now loads the form specific field configuration
rather than expecting DevHelp::Validate to do it (which shouldn't
really have been modified to handle it)

=item *

using custom validation rules would cause a 500 error.

=back

=head2 0.15_08

=over

=item *

subscription calculations no longer include incomplete orders.

=item *

the user and ifUser tags are now available on the user/lostpassword
template.

=item *

localinst.perl (used by make test, make testinst, make testfiles) no
longer ignores empty config values.

=item *

the article keyword field now defaults to empty rather than NULL.

=item *

fmail.pl forms can now be select, multiselect, radio or check button
fields.  The values can be specified in the config file.  See
docs/formmail.pod for details.

=item *

the emails sent by fmail.pl can be sent encrypted or encrypted and
signed.  See docs/formmail.pod for details.

=back

=head2 0.15_07

This release adds a new column to the orders table.  You will need to
run the upgrade_mysql.pl script on existing installations.

=over

=item *

product information is now available from the item tag on the final
checkout page

=item *

another field has been added to the orders table to track the
difference between an order that's been created for payment
processing, and an order where it's been completed.

The existing order lists filter out the incomplete orders.

=item *

if a user attempts and fails online credit card processing on an
order, that order record (and hence number) is now re-used for the
next attempt.  Note: if a user abandons an order after a failed
attempt at online credit card processing then an incomplete order is
left in the database.

=item *

added an order_list_incomplete target which lists only incomplete
orders (for completeness...)

=item *

the order_detail template now flags incomplete orders and attempts to
display credit card processing information.

=item *

the embed tag and embed[] markup didn't support newer style tags

=back

=head2 0.15_06

Interim release with some minor fixes while I fiddle with trying to
re-use the same order after a CC processing failure.

=over

=item *

0.15_05 field name changes meant that values from the logged on user
record weren't used for delivery fields.  The checkout page now adapts
for that.

=item *

previously if you submitted the checkout page, then went back to it,
it would use the defaults from the logged on user (or empty fields).
Now it uses those saved values as defaults.

=item *

the cardType field is no longer required, or processed.

=item *

the extended cart fields are now available on the cart and checkout
pages, since it isn't used anywhere anyway.

=back

=head2 0.15_05

WARNING: this release makes major changes to the way the shop works.
Make sure you test B<BEFORE> you deploy.

This release may introduce incompatibilities with older BSE::Custom
modules, if you come across any of these, please let me know.

To deploy this with a custom template set the following templates will
need to be updated:

  - checkoutnew_base.tmpl - new checkout page
  - checkoutpay_base.tmpl - new payment page
  - mailconfirm.tmpl - handle CC processing
  - mailorder.tmpl - handle CC processing
  - checkoutfinal_base.tmpl - display credit card receipt number

This is primarily intended as a test release, currently it has three
known problems:

=over

=item *

the checkout page won't load the saved order values if you go back to
it after having gone through it without finishing the order.

=item *

each failed online credit card transaction results in a new order in
the database (marked as failed)

=item *

some admin side templates still need updating

=back

The changes:

=over

=item *

major changes to the structure of the shop, There is no longer a
purchase action, this has been split into an order action, which saves
user information, and a payment action, which attempts to process a
payment.

The initial checkout page now uses the checkoutnew template rather
than the checkout template.  The payment page uses the checkoutpay
template.

=item *

the final order display is now a separate request from the
purchase/payment action, you can now make changes to the template and
test them without having to create a new order each time.  The final
order display page will only display the last successful order for 5
minutes.

=item *

the shop can now process credit card transactions online through the
Inpho credit card gateway.  There is also a also a "test" gateway
module that allows for offline testing.  See [shop].cardprocessor in
config.pod

=item *

the shop (and other scripts that use the general dispatcher, like
affiliate.pl and fmail.pl) should now work with image buttons
submitting the form.

=item *

conditions to check for payments types on the shop pages that accepted
a payment type name (like <:ifPayments Name:>) would always return
value for the CC type, even when it was enabled.

=item *

fields that were marked as required previously are now actually
required, this most likely a problem for the cardType field.  I may
end up marking this as not required.

=item *

a new credit card field value is accepted and passed to the online
credit card processor, the cardVerify field.

=item *

fields on the checkout page now must use the name defined in the order
record.  The older names are no longer usable, except in the required
method of BSE::Custom.

=item *

the error_img tag is now available on the checkout and payment pages

=back

=head2 0.15_04

=over

=item *

the allkids iterator no longer lists unlisted stepkids

=item *

added the [article defaults], [product defaults] and [catalog
defaults] configuration file sections, see L<config.pod> for details.

=back

=head2 0.15_03

=over

=item *

generate.pl would refresh to the wrong place when secure admin was
configured, causing the logon page to be displayed.

=item *

reorder.pl had a syntax error which didn't show in the test suite.
The test suite has been updated to catch similar errors in reorder.pl

=item *

the low level body text formatter now includes <p></p> around its
results.  Many other minor changes were made to hopefully improve the
output from the formatter.

=item *

the level2 tag now HTML escapes its results

=item *

the old tag is now more backward compatible.

=item *

changed the search index primary key from "varchar(200) binary" to
"varbinary(200)".  Unfortunately mysql 3 reports this type as
"varchar(200) binary" so the tool we use to build mysql.str has been
mangled to convert that type to varbinary.

=item *

the article table included a default value declaration in the column
spec for the primary key.  This conflicts with the auto_increment on
mysql 4 and has been removed.

=item *

the makefile now checks for .pl files that still include the option to
start the debugger in their #! lines before building a dist.  This
will prevent releasing a dist that tries to start the debugger when
you call a script.

=item *

the search results page now has access to the basic dynamic tags

=back

=head2 0.15_02

=over

=item *

added the fmail.pl script, see formmail.pod for information on using
this.

=item *

reorder.pl now accepts a type parameter to sort only those children
that have the appropriate generator.

=item *

catalogs now use the standard iterator tags for products, allprods,
stepprods, and adds an allcats iterator.

=item *

shopadmin.pl now supports the shop article being a catalog, adding the
shop tag and products iterator for the base product_list template.

=item *

the summary and thumbnail tags didn't work with newer style article
tags

=item *

the drop-down parent list for catalogs no longer includes the current
catalog or its children.

=item *

you can now parent products to the shop article if it's a catalog.

=item *

the dynamic C<old> tag can now accept the field name as a [] parameter.

=item *

body text is now generated with surrounding <p> and </p> tags.

=item *

added the div[class|text...] formatting tag

=back

=head2 0.15_01

=over

=item *

formatted lists where there was no other text between the lists would
produce mis-formatted lists.

=item *

the tt[] and pre[] tags were not removed from search result except
text. (#460)

=item *

creating a new user with subscriptions enabled could sometimes cause a
500 server error.  This was due to calling escape_url() instead of
escape_uri().  Thanks to Piers Johnson from Might Media for reporting
and patching this.

=item *

added the billMobile and delivMobile fields to the orders and site
users tables

=item *

the user tag in user.pl could sometimes produce undefined value
warnings in the error log.

=item *

search excerpt text is now correctly HTML escaped

=item *

added the strepeats iterator for use on all pages (resolved on the
first build when pre-building templates for dynamic pages)

=item *

added the dI<digits> prefix to the arithmetic tag, which rounds the
result, so for example:

  <:arithmetic d2:1.234:>

results in:

  1.23

=item *

C<img> elements produced by the thumbnail tag now include an empty alt
parameter.

=item *

the tt[...] tag is now removed from body text in those cases where
we're removing other tags

=item *

added the delivMobile and billMobile columns to the site_user and
orders tables.  These are saved and transferred in the appropriate
places.  The core templates have been changed to display or edit them
where appropriate.

=back

=head2 0.15

No changes since 0.14_37, no issues reported with 0.14_37.

=head2 0.14_37

This will become 0.15 on Friday unless a major problem is reported.

=over

=item *

The ifRemovable tag on the subscription list should no longer produce
undefined value messages.

=item *

you can now configure a site user (member) flag that must be set for
the affiliate page to be displayed for that user.

=item *

documented the [site user flags] configuration file section

=back

=head2 0.14_36

Trying again for a release candidate for 0.15.

=over

=item *

the <:money ...:> when used on static pages, or when resolved when
pregenerating base pages, would ignore the third and subsequent
arguments.

=item *

the checkupdate target for the checkout page would crash if there was
no custom session data defined.

=item *

the final purchase page did not have access to the normal BSE static
tags

=item *

the switch tag didn't handle the protocol used to handle unimplemented
subtags.

=back

=head2 0.14_35

This is a release candidate for 0.15.

=over

=item *

you can now use the |x flag on a tag to re-encode the value suitably
for XML (to avoid HTML entities like &eacute;).  Note: since most BSE
tags already HTML escape their data, this tag will convert HTML
entities to characters before re-encoding as XML.

=item *

the allkids_of, kids_of and inlines iterators now support the [tag
...] syntax for their arguments.  Any values returned by the [...]
constructs are further split on spaces, so you can have a single tag
return more than one value here.  This is convenient if you want to
use the cfg tag to specify article numbers from bse.cfg.

=item *

the <:date ...:> tag now presents the correct day of week. (#450)

=item *

added a new tag C<nobodytext> which strips all bodytext markup from
its argument.

=item *

subadmin.pl now uses the bse_subscr_* prefix for it's various security
checks

=back

=head2 0.14_34

=over

=item *

thumbnails weren't implemented for the site view/global image manager,
they are now available there

=item *

you can now supply a new date selection code to the search engine,
'mI<number>' will now only list articles that have been modified
within the last I<number> days.  The supplied search_base.tmpl has
been modified to include this. (#136)

=item *

updated internal file extension to MIME types based on a list from
Adrian, types which are basicly text files (like
C<text/x-script.bash>) have been changed to C<text/plain> so browsers
don't need to know about obscure aliases for text file types.

=item *

doing a refresh due to failure in adding a product to the cart (due to
subscription restrictions for example) when the product had options
would cause a 500 error (#438)

=item *

the arithmetic tag should handle double generated pages where tags
needed on the second generation are used in the expression.

=item *

we now URI escape apostrophe C<'> when we're URI escaping in general,
since a trailing unescaped C<'> could confuse some browsers in a
Refresh header.

=item *

cgi-bin/admin/admin.pl now refreshes to the menu with an error message
rather than causing a 500 error if it cannot find the article
specified by C<id>. (#424)

=item *

saving a disabled user from the member admin page will no longer send
the user a confirmation message if they are unconfirmed and have
subscriptions selected. (#393)

=item *

a change not listed for 0.14_05 - the delivery instructions entered
during checkout are now included on the encrypted order emailed to the
site admin. (#354)

=item *

the validation error icon image can now be configured, see [error_img]
in config.pod. (#230)

=back

=head2 0.14_33

=over

=item *

user.pl now has an C<a_orderdetail> target which accepts the order
number in C<id>.  The order must belong to the currently logged on
user to be displayed.

=item *

affiliate.pl will no longer display pages for disabled users (#437)

=item *

the image manager will now display images as thumbnails if configured
to do so.

Currently the only imaging tool that can be used for the thumbnailing
process is Imager.

This adds the thumbimage, ifThumbs and ifCanThumbs tags to the article
editor pages.

See thumbnails.pod for more information.

=item *

localinst.perl (run with make testfiles) no longer deletes the content
of your htdocs/images directory.

=back

=head2 0.14_32

=over

=item *

logging out now clears the shopping cart

=item *

after logging in when you failed to add an item requiring logon now
refreshes back to adding the item again (#434)

=item *

setting [affiliate].subscription_required to an affiliate text id
should now work

=item *

trying to add a subscription product while not logged in now refreshes
more appropriately after you logon.

=item *

checks for renew/start only subscription products are now done when
you attempt to add the product to your cart.

=item *

SiteUser.pm was missing an import of sql_add_date_days(), which caused
a 500 error.

=item *

the subscription expiry date functions were checking the wrong field
name for the expiry date.  This caused problems when trying to add a
renewal product to the cart, amongst other things (#435)

=item *

the userpage now has access to a subscriptions iterator, includes
access to the subscription fields, and the ends_at, started_at and
max_lapsed status fields.  This only shows subscriptions the user is
subscribed to. (#436)

=item *

the options page now has a ifSubscribedTo tag.  This accepts one
parameter which is the text id of the subscription.

=item *

the subscription order summary on the subscription detail page now
multiplies the period by the number of units bought

=back

=head2 0.14_31

=over

=item *

you can now configure a required subscription for affiliates, see the
documentation for C<subscription_required> in L<config>.

=item *

the product tag on the checkoutfinal page now accounts for database
NULL values

=item *

the subscription detail template didn't display the usage field
correctly

=item *

the delete subscription link was incorrect

=item *

the delete subscription confirmation template wasn't supplied

=item *

the subscription edit/add templates were missing a closing </tr>

=item *

removed debug code from Squirrel::Row that was sending
C<add>I<classname> to the error log.

=item *

the test for whether a user was subscribed was incorrect.

=item *

the number of units of a product bought for a subscription product was
ignored, now 2 units of a 2 month sub product will act as 4 months.

=item *

it is now possible to include other config files from bse.cfg, see
[includes] in C<config.pod> for more information.

=item *

the doclink[] and popdoclink[] tags would not be removed from the
search page excerpts if the second parameter was present but empty.

=item *

more recent code using the m parameter could crash if the script was
passed two m parameters.

=item *

a method rename during development meant that some code was calling a
method that didn't exist, causing a 500 error.

=item *

if you supply an 'r' parameter that defines an 'm' parameter to
subadmin targets the code will no longer add it's own 'm' parameter.

=item *

DevHelp::Validate now includes some documentation of its built-in
rules.

=back

=head2 0.14_30

The basic processing for subscriptions is now done.

=over

=item *

added max_lapsed to the order_item table, to make sure subscription
expiries remain consistent.

=item *

the bse_subscriptions table was commented out for the last release (it
worked here because the table was created before I commented it out
<sigh>)

=item *

ordering items with a subscription now results in the
bse_user_subscribed table being updated, and hence most of the code
which checks if a user has subscribed now has something to check

=item *

the users iterator on the subscription details page now works

=item *

subadmin.pl now has a target to update all users subscription expiry
dates from their orders.

=item *

messages usually weren't displayed from a refresh by subadmin.pl, when
they should have been

=item *

modern iterators could cause 500 errors (bad parameter list
internally)

=item *

modern iterators could generated undefined value warning in the logs

=item *

switched off debugging for Squirrel::Template, which should reduce log
pollution considerably.

=back

=head2 0.14_29

=over

=item *

I'm planning on making all base BSE permission checks use a "bse_"
prefix to avoid conflicts with add ons like nPort.  The permission
checks should all now allow checks against bse_foo when only the foo
permission has been granted.

This should allow templates to be updated to use the C<bse_> prefix.
Note that the permission sets in bse.cfg must continue to use the
non-C<bse_> names for now.

=item *

most of the structure of subscriptions has been done, provided for
templating and testing.

Note in particular that the users iterator on the subscription details
page will return an empty list for now.

=item *

0.14_24 added ".html" to the end of "link title" links, this broke
regeneration.  This release changes that to "_html" at the end of the
links, which shouldn't break regeneration and will hopefully still
allow google to index them.

I'll probably preserve the current behaviour if we add a mechanism for
setting the content filenames, since unlike filename changes this
preserves the link, so a title change won't break links from external
sites.

=item *

added site/docs/future_plans.pod to the distribution

=back

=head2 0.14_28

Release in preparation for subscriptions implementation

=over

=item *

deleting site user images didn't work - the SQL used to remove the
record was incorrect

=back

=head2 0.14_27

=over

=item *

it's now possible to associate images with a site user (member), these
are editable both by the admin and the user themselves.

They work the same as the nport member images.

By default they are stored in the same location as uploaded files
(defaulted in the config file.)

Don't forget to change your custom admin edit site user template to
use the right enctype for the form.

=item *

you can now use siteuser images on the affiliate page.

=item *

SiteUser.pm was still using Orders rather than BSE::TB::Orders <sigh>

=item *

affiliate_name can now be set during registration or during addition
in the admin interface.

=item *

the require_affiliate_name flag in the config file is now supported
(it wasn't necessary for the original application)

=item *

[site users].display_affiliate_name is now used in validation errors
for the affiliate name field.

=back

=head2 0.14_26

=over

=item *

the referer checks for affiliate.pl extracted the Referer header
domain incorrectly.

=item *

the order affiliate_code is now accepted as a CGI parameter during
purchase if it isn't set in the session.

=item *

the order siteuser_id field wasn't being set

=item *

added an affiliate_name column to the siteusers table.  This value is
required to be unique if non-empty and may only contain alphanumeric
characters.  You will need to add this to any custom templates.

=item *

affiliate.pl now accepts alternatives to the id parameter:

=over

=item *

lo - the logon name of the user

=item *

co - the affiliate name of the user

=back

=item *

some prep work for site user images

=back

=head2 0.14_25

=over

=item *

a few modules were still using Orders/OrderItems instead of
BSE::TB::...

=item *

work around a discrepancy in the way mysql handles dates, step child
records marked to be released on a given date should now be released
on that date rather than the next day

=item *

added affiliate.pl, which can display an affiliate page or set the
saved affiliate code.

=item *

extra fields have been added to the site users table to allow for
custom data on the affiliate page.

=item *

a new debug flag dump_session has been added. if this is true then a
data dump of the session hash is performed after it is retrieved from
the database.

=item *

some of the order processing code checked incorrectly for
subscriptions (which don't exist yet anyway).

=back

=head2 0.14_24

This release includes some structural changes to article editing,
please test before deploying it.

=over

=item *

doing a sort of all children wouldn't include the unreleased
(step)childen in the sort (#389)

=item *

with access control enabled, using the reorder.pl script while not
logged (including due to a cookie timeout) on would produce a server
error (#419)

=item *

the Orders / Order / OrderItems / OrderItem classes are now
BSE::TB::Orders / BSE::TB::Order / BSE::TB::OrderItems /
BSE::TB::OrderItem, to try to use a more consistent naming system and
clean up the top level namespace

=item *

the prePurchase target has been disabled in shop.pl, since it's
effectively unmaintained, and probably completely broken

=item *

updated the document list of session values in BSE::Session.

=item *

defaults (both internal and configured) are now used to set
article/product fields on creation, this should allow simplified
creation templates to omit fields that don't need to be explicitly set

=item *

the warning about $Text::Wrap::columns only appearing once should
disappear

=item *

a shipping_cost column has been added to the order table.  This is not
set by BSE at all yet, but is available for use by custom order save
code.

=item *

some fields and code have been added to support subscriptions (no, not
the newsletter stuff)

=item *

removed some debug dump code from the shop

=item *

"link title" links now include ".html" at the end to allow Google to
index them

=item *

some preperatory work has been done to handle affiliates and
subscriptions

=back

=head2 0.14_23

=over

=item *

differences in whether CR chars are passed in line separators could
cause formatting problems with ##/**/%% lists in body formatted text

=item *

a ##, %% or ** which wasn't at the beginning of a line could be
treated as part of a formatted list

=back

=head2 0.14_22

=over

=item *

the logon page used the user side help icons (#371)

=item *

the admin user and admin site user pages used the user side help icons
(#373)

=item *

the change password page used user side help icons  (#378)

=item *

the admin logon page now accepts an m parameter

=item *

in general, moved the common admin tags call after the common basic
tags call so that admin tags (like the admin help icon) replaces the
basic help icon.

=item *

remove blank lines from the error messages produced on the admin user
administration pages (#382)

=item *

a very rough attempt at changes to support UTF-8 content has been made.

Don't rely on this.

=item *

previously, if an error occured in producing a template that wasn't a
template not found error, while using an alternate template, a 500
error would be produced with no message in the error_log.  Now an
error page is produced, with the message sent to STDERR (and hence to
the error_log).

=item *

BSE::DB::Mysql no longer reports that it found SQL in the database.

=item *

when link titles were enabled they were being produced twice.

=item *

added the <:today:> tag - returns the current date, by default
formatted as "dd-mm-yyyy", but can be reformatted as per the <:date
...:> tag, for example <:today "%d/%b/%Y":>

=item *

added the <:arithmetic ...:> tag.  Any text [I<word> ...] text in the
argument is replaced with the corresponding tag value and the final
result is then evalled.  Do not ever use [cgi ...] values or any other
unvalidated data with this tag, to avoid security issues.

=item *

the <:sorthelp ...:> tag now seperates the returned URL arguments with
&amp; instead of just & to produce correct HTML.

=item *

the url tag now generated absolute URLs in subscriptions

=back

=head2 0.14_21

=over

=item *

non-lower-case link[] commands in subscription body text was causing
500 errors, (doclink[] with unknown article names/ids could cause the
same issue)

=item *

the <:help file entry:> tag can now be used in all templates, and
optionally takes a style argument, with the default style depending on
context.  This tag is replaced as pregeneration time for pregenerated
pages.

In user pages (including the admin version of article pages) the style
defaults to "user".

In admin pages the style defaults to "admin".

The style chosen can select a template, and change icons and path
depending on the configuration file, see [help style ...] in
L<config.pod>.

=back

=head2 0.14_20

=over

=item *

BSE::Mail::* now accept a bcc address parameter.  This is intended for
use by nPort.

=back

=head2 0.14_19

=over

=item *

image[...|url] was HTML encoding the url twice.

=item *

added an output_result() method to BSE::Request.  This is currently a
shim around BSE::Request->output_result(), but it may change in the
future.

=item *

added the <:oldi ...:> tag, for use on any dynamic page

  <:oldi fieldname index func funcargs:>

This is used for extracting the correct previously entered value for a
multi-value field.

=item *

the default <:old ...:> tag was ignoring the fourth and subsequent
parameters, for example, if the tag was:

  <:old fieldx taga arg1 arg2:>

only arg1 was being passed to taga.

=back

=head2 0.14_18

=over

=item *

site/util/mysql.str hadn't been updated to the new format

=item *

added some support code for use in nPort.

=back

=head2 0.14_17

=over

=item *

makeIndex.pl was passing in incorrect parameters in a few places to do
with article formatting

=item *

added the poplink[] and popdoclink[] a body text tags

=item *

the link[] tag now uses the URL as the link title if no title is
provided

=item *

the show_register target of user.pl now accepts a C<_t> argument as a
template selector.

=back

=head2 0.14_16

=over

=item *

upgrade_mysql.pl now takes a -i filename for the extra table
structures to be installed.  A -h for help option was added too.

=item *

the format of the database structure file for upgrade_mysql.pl has
changed, to allow for column types containing commas (like
decimal(9,2)).

=item *

tbe table[htmloption="value" ... ] form of the table body tag no
longer HTML escapes the options. (#348)

=item *

one of the changes to use the new formatter for summaries mixed up an
argument order, breaking the <:summary ... :> tag (#347)

=item *

fixed some problems with the new sorting features in reorder.pl.

=item *

BSE::DB::Mysql will now attempt to search the sql_statements table for
any SQL needed that isn't found in its internal table.  This is
intended for use by external applications using BSE's database support
tools, specifically for the nport project.

=back

=head2 0.14_15

This adds several destabilizing changes, test before using in any
production setting.

=over

=item *

you can now specify that BSE uses the configured secure URL, the
normal URL or a separate admin base URL for access to administrative
functions.  The action parameter on any custom admin/logon.tmpl should
be changed to include the new <:adminbase:> tag.

=item *

reorder.pl now accepts a more sophisticated C<sort> parameter, it can
now be a comma separated list of fields to sort by, most significant
at the front.  Any unknown fields are ignored.  You can put C<-> in
front of any field name to sort that field in reverse.

=item *

the image[] and gimage[] tags now take a fourth parameter which can
either be a simple class name (all alphanumeric), a set of parameters
to the C<padding:> style command, or actual CSS style commands.

=item *

lastModified is now a datetime rather than a date, be sure to run
upgrade_mysql.pl

=item *

applied a change to the default table mapping from extension to MIME
content type, sent in by Adrian.

=back

=head2 0.14_14

=over

=item *

added the style[] body text tag

=item *

doclink[], class[] and style[] are now removed correctly from summary
and excerpt text.

=item *

the hr[] body tag now correctly uses C<size> instead of C<height>.

=item *

moved the custom_class() function to the new BSE::CfgInfo class.

=item *

first steps towards administration via the secure URL (or some other
base URL)

=item *

the <:admin:> tag can now produce output based on a template.
<:admin:> in an article template uses C<admin/adminmenu/article.tmpl>,
<:admin:> in a product template uses C<admin/adminmenu/product.tmpl>,
<:admin:> in a catalog template uses C<admin/adminmenu/catalog.tmpl>,
<:admin foo:> uses C<admin/adminmenu/foo.tmpl>.

=item *

sorting the site user list by id should now sort numerically rather
than stringwise.

=item *

You can now you %% instead of ## in body text for an alphabetical
rather than numerical ordered list

=back

=head2 0.14_13

=over

=item *

reworked the doclink[] changes so an article didn't need to be
supplied to the formatted.  This fixed the <:bodytext ...:> tag.

=item *

word-wrapping in the text version of body text for subscriptions would
move the last word of a multi-line paragraph onto its own line,
whether it needed to be or not.

=item *

the way links appear in the text version of body text, and the link
list at the end can now be customized through the configuration file,
see the documentation on I<text_link_inline>, I<text_link_list> and
I<text_link_list_prefix> in config.pod for more information.

=item *

handle [] inside body text tags a little more intelligently.  We
assume they are balanced, so b[foo [1]] will do the right thing, but
b[foo [] won't.

=back

=head2 0.14_12

=over

=item *

added doclink[] body tag

=item *

cookie generation is now centralized to prevent differences in cookie
generation from causing problems.  This won't help with certain
configuration issues, which you'll need to fix yourself.

=item *

allow files not marked for sale, and listed in an ordered item to be
downloaded by a user from the userpage.

=item *

order files listed for an order on the userpage by item and display
order instead of alphabetically

=item *

filenames for uploaded files with non-alphanumeric characters are now
handled a bit differently - non-alphanumerics are now replaced with
'_' and then duplicate '_' are removed.

=item *

userpage base pages are now generated with an absolute link field to
force absolute article URLs to be generated

=item *

the text version of emails in subscriptions now includes the URL at
the bottom of the body text, with a bracketted number at the original
text

=item *

the edit member page now links to a list of orders for that user (if
any)

=item *

the order detail page now links to the user's order list and their
edit page.

=back

=head2 0.14_11

=over

=item *

logon.pl still required mod_perl.

=item *

subscription messages were being sent to subscribed but disabled
users.

=item *

the search results page tags are now XHTML compatible.

=item *

you can now set pp=-1 on the member list page to list every user.

=back

=head2 0.14_10

=over

=item *

the stepkid tag would sometimes result in a warning in the web server
error log

=item *

the templater would produce a warning from a <:switch:> tag under perl
5.8.

=item *

the installer while now set the #! line of scripts based on the "perl"
configuration option in test.cfg.

=item *

some scripts would produce compilation errors when run under a perl
without mod_perl installed.

=item *

the implementation top/bottom left/right image placement has changed.
When you select a "bottom" option the images are simply placed as if
they were present in reverse order.  This means that the image urls
are now used to form links.

=item *

gen.pl could produce a compilation error in some circumstances.

=item *

the telephone field is now actually required on checkout.

=item *

if the user options form included the email address but not the
subscriptions list and the user changed their email address, the
confirmation email wasn't being sent.

=item *

the <:ifItemAvail:> tag wasn't returning true for files that don't
require payment

=item *

spaces are now preserved in uploaded filenames, as underscores.

=back

=head2 0.14_09

=over

=item *

the <:switch:> template construct had required there be some text
between "<:switch:>" and the first case, this is no longer necessary.
You still might want to keep a newline there to make it easier to pick
out cases

=item *

the list of possible archive parents for subscriptions is now sorted
by title (#295) We now select the highest id article by default when
creating a new subscription, presuming it was created to store an
archive.

=item *

the <:recipient_count:> tag is now available on the subscription send
form, and the Send link is now always available on the subscriptions
list. (#269)

=item *

the subscription send action, if it somehow is submitted with no users
subcribed, will no longer archive an article and update the most
recent send date.  This can happen if the last user unsubscribes while
the administrator is composing their newsletter.

=item *

the class[] body text tag now nests correctly when spanning over
paragraphs

=back

=head2 0.14_08

=over

=item *

If the last value of a parsed tag parameter list was an unquoted 0,
the 0 was not passed to the tag for processing.

=item *

added the cfgsection iterator.

=item *

iterators that allowed sorting/filtering now actually sort on the
right value

=item *

the stepkid tag on edit pages now checks the article is a stepkid
before doing a hash lookup, preventing an undefined value warning

=item *

the admin/edit_steps template was using invalid article names in
ifUserCan checks

=item *

the flags iterator and ifFlagSet tags weren't available on the add
site user page.

=item *

saving a site user in nopassword mode would result in a validation
error if the email field was present but no confirmation email field
was present.  The confirmation email field is now only required if the
supplied email address is different from that currently stored for the
user.

=item *

changing the user's email address in nopassword mode (and possibly in
normal mode with subscriptions) resulted in a server error.

=item *

printable.pl wasn't looking in the printable/ directory for it's
templates (#298)

=item *

printable.pl's error reporting wasn't supplying the config value to
the templater

=item *

printable.pl's error page now uses the article templater rather than
the base templater

=item *

added smoke test for errors from printable.pl

=item *

added smoke test for admin/siteusers.pl

=item *

trying to call "site users" "site members" now.

=item *

you can now select subscriptions for a site member with the admin
tool.  This still results in a confirmation email if the user hasn't
been confirmed at their email address. (#293)

=back

=head2 0.14_07

You will need to run upgrade_mysql.pl for this release.

=over

=item *

checkoutfinal_base.tmpl now uses the new <:if Payment I<name>:> tags,
and includes a payments customization shim.

=item *

shop.pl now uses [shop].display_I<field-name> to convert stored field
names into display names for error messages.

=item *

cardType and cardHolder fields are now required fields for credit card
payments

=item *

admin access control now requires that a configuration option to be
set before it will accept admin user authentication information from
the server (typically basic authentication.)

=item *

the class[I<classname>|I<text>] tag was lost when integrating the
common tag handling code, added it back in (#284)

=item *

you can now define custom flags for site users, the flag value is a
single letter or digit, case-sensitive.  Add an entry like:

   I<letter-or-digit>=I<description>

to the [site user flags] section of the config file.  For example:

   a=Access to private area of the site
   b=Accept orders on account

You can check this on templates where the user is visible with the
<:if Match:> tag:

  <:ifMatch [siteuser flags] "b":>Accept orders on account<:or:><:eif:>

=back

=head2 0.14_06

=over

=item *

the article editor was using [catalogs].template as the default
template rather than the documented [products].template

=item *

added the [products].extra_templates configuation file entry.  This is
a comma-separated list of extra templates that can be used for
products.  You can also just put templates into the C<products>
directory (and have been able to for a while.)

=item *

the <:include ...:> meta-tag now takes a second optional argument, if
this is the word "optional" then no error text is inserted if the file
specified is not found.

=item *

updated includes of custom shims to use the "optional" option

=item *

removed custom includes from the distribution that didn't have any
real content

=item *

reorganized menu.tmpl a bit and added the member ("site user") manager
to the list

=item *

added <:if Payments I<name-of-type> :> and <:checkedPayment
I<name-of-type> :> tags to the checkout page, and <:if Payment
I<name-of-type> :> to the checkoutfinal page.  If I<name-of-type> is
unknown these will return false (or the empty string) to allow their
use in portable templates where a specific type might not be
configured.

=item *

the checkout page now uses the ifUser tag to check if there's a logged
in user rather than hacking on the user cookie.

=back

=head2 0.14_05

This is still a development release.

There have been database changes in this release.  You will need to
run upgrade_mysql.pl.

=over

=item *

CRITICAL: nopassword wasn't checking the password at all.  If you
don't want to upgrade completely you can include just the three line
change that checks the password.

=item *

blank lines are no longer included in the error messages on add/edit
site user validation errors

=item *

the shop now uses the site user authentication hook

=item *

the domain value sent to the browser in cookies now has the port
number stripped.

=item *

you can now configure new payment types through the [payment type
names], [payment type descs] and [payment type required] sections of
the configuration file.

=item *

various templates include custom sub-templates which can be used to
add custom payment types.

=item *

new <:checkedPaymentI<payment-type-name> :> tag on the checkout form
to make retaining the selected payment type easier.

=item *

new basic template facility, C<with> allows sections of text to be
processed by a tag:

  <:with begin I<tagname> :>
    I<some text>
  <:with end I<tagname :>

=item *

<:with ... wrap:> tag added to order email tag sets:

  <:with begin wrap:>Special Instructions: <:order instructions:><:with end wrap:>

=item *

the site user editor would include empty lines for valid fields in
error messages

=item *

cookies were being generated with the port numbers included in the
domain value.

=item *

billing address fields are now included in the default checkout form,
optionally

=back

=head2 0.14_04

This is a development release and is not suitable for production use.

=over

=item *

sort ordering, pagination information is now saved in the site user
list

=item *

added a customization hook called when a change is made to the site
users list

=item *

added a site user authentication hook.  You must set user_auth=1 in
the [custom] section of the config file for this to be used.

=back

=head2 0.14_03

This is a development release and is not suitable for production use.

=over

=item *

in some cases registration or saving user options wasn't outputting a
page, producing a 500 error

=item *

user options templating changes:

=over

=item *

for the textOnlyEmail option to be saved, a saveTextOnlyMail hidden
field should be present with a non-zero value

=item *

for the keepAddress option to be saved, a saveKeepAddress hidden field
should be present with a non-zero value

=item *

for the subscriptions to be saves, a saveSubscriptions hidden field
should be present

=back

=item *

added site user manager, this still needs some template work

=item *

user registration can be disabled with the C<user_register> option in
the C<[site users]> section of the config file (you can still create
users using the site user manager.)

=item *

billing information fields have been added to the site_users table.

=item *

adminNotes field has been added to the site users table (editable only
by admins.)

=item *

instructions field has been added to the orders table, for shipping
instructions (or any).  This still needs some support on the admin
templates, and the email templates.

=item *

added config option C<billing_on_main_opts> to control whether billing
options are on the main user options page.  This is managed by the
templates, not the code.

=back

=head2 0.14_02

=over

=item *

printable.pl was producing a server error (it hadn't been updated
after the top tag was added.)  Also added a smoke test which would
have caught it.

=item *

added a few more reports to the experiemental reports system

=item *

report.pl now handles being called when the user isn't (or is no
longer) logged on, correctly

=item *

added some cookie debugging code

=item *

confirmation emails weren't being sent when a user registered with
subscriptions selected (with nopassword unset)

=back

=head2 0.14_01

=over

=item *

you can no longer register or save in options a blacklisted email
address

=item *

email address blacklisting now works

=item *

user options can now be set during registration

=item *

you can configure which user options are required (during both
registration and in user options)

=item *

the subscription boxes can individually or all be set to checked
during registration by default.

=item *

the error_img tag now works on the registration and user options pages

=back

=head2 0.14

No changes in this release, just a stable release.  Enjoy.

=head2 0.13_08

This is a release candidate for 0.14, please report any problems with
it as soon as possible.

Once I release 0.14 I'll start on a new round of changes

=over

=item *

the common <:old I<name> I<func> I<args>:> tag was HTML escaping the
result from the <:I<func> I<args>:> call, which gave a double escaped
result.

=item *

the test count in t/t40images.t was incorrect

=item *

even more tests have been added to t/t40images.t

=back

=head2 0.13_07

=over

=item *

URI::Escape escaped a different set of characters by default in older
versions, not including &, we now supply the set of characters that is
the default in modern versions.

=item *

you shouldn't be able to add an article to itself as a stepchild or
stepparent

=item *

some admin forms now include name attributes, as an aid to regression
testing

=item *

added some simple tests for Squirrel::Template

=item *

added some simple tests for the image manager (needs more work)

=back

=head2 0.13_06

Making steps towards improved stability.

=over

=item *

the subscriptions formatting was broken when I made arrows refresh
back to their original article. D'oh.

=item *

the test text only email flag was ignored

=item *

an old problem, only products were listed as stepchildren to catalogs
in the article editor

=item *

changes to the way named images interact with automatic image placement:

=over

=item *

named images are never automatically placed

=item *

named images are not included in the list produced by the article
display template images iterator

=item *

referring to a named image either with image[name] in the article
body, or <:imagen name:> in the template will not suppress automated
image placement

=item *

image[1] or <:image 1:> will continue to suppress automatic image
placement (or <:image:> within the images iterator)

=back

This should provide reasonable behaviour that's compatible with
existing sites running 0.13 or earlier.

=back

=head2 0.13_05

If you get configuration errors from this release, it probably means
you've been using some of the default email addresses, which were
either nonsense, or my address.  Either update Constants.pm or set the
appropriate value in bse.cfg.

There have been a lot of changes in this development release, so
there's probably at least one bug.

=over

=item *

removed my email address from the config files

=item *

datadump.pl now uses $DATA_EMAIL as a default for the configuration
[datadump].to value, as documented.  Also, aborts with a configuration
error if this isn't set.

=item *

swapped the order of the parts in the multi-format emails sent by the
subscriptions manager, since the old order didn't work with some mail
clients.

=item *

subscription confirmations were being sent with a from derived from
the [confirmation].from key instead of the [confirmations].from key in
the config file.

=item *

the configured from address is now checked before attempting to send
the subscription.

=item *

title and body are now validated on sending a subscription (#264,
#265)

=item *

parameters supplied with the <:wrap ...:> construct now have tags of
the form [tagname parameters] replaced in values.

=item *

the subscriptions send form now allows sending a test subscription
message.  Defaults for the email and name are controlled by the
[subscriptions] section of the config file.

To use this you must be authenticated in some way, either by BSE's
user logon system, or through browser authentication (.htpasswd), this
is done to prevent abuse of the system by spammers.

=item *

imageclean.pl should no longer remove global images

=item *

changepw.pl now accepts the r paramater as a refresh URL on the save
step

=item *

select tags generated by BSE in various places should now be XHTML
compatible

=item *

most object reordering arrows are now generated using a common function

Only the <:moveUp:> and <:moveDown:> tags are excluded from this, and
are now considered obsolete, please use the new <:movekid:> tag
instead.

=item *

URLs in object reordering arrows included unescaped & characters

=item *

BSE generated select tags were using "checked" instead of "selected"
in some places, oops.

=item *

if a user subscribes, and a confirmations from address is configured
we now display an error before the attempt to send a message, and no
longer record that an attempt has been made.

=item *

the subscriptions help file was missing </a> on the <a name="..."> tags

=item *

some templates are now more XHTML compatible (if anyone know how to
make http://validator.w3c.org accept wrap="virtual" without adding "]
>" to the top of the displayed page, please let me know.)

=item *

arrows on the display pages should return you to your original article
now

=item *

added the <:top I<field>:> tag which allows access to the top level
article being generated

=item *

the shop now complains if either shop email address is not configured
when a customer attempts a purchase.

=item *

you can now disable encryption of the email order to your shop email
address, this disables credit card orders.  Check the documentation on
the C<noencrypt> option in the C<[shop]> section of the config file in
L<config.pod>.

=item *

you can now control whether the shop sends an email of your order to
the shop email address through bse.cfg, see C<email_order> in the
C<[shop]> section, documented in L<config.pod>.

=back

=head2 0.13_04

I'm still looking for feedback on article image names and the
interaction with automatic image placement.  See the options described
under the 0.13_02 release notes.

This development release has some major changes.

=over

=item *

the delete item handler in the shop now uses the common refresh code,
preventing problems with Safari.

=item *

the <:old:> tag on the checkout page didn't work correctly in some
cases

=item *

moved the response dispatch code template to BSE::Template to avoid
duplication

=item *

admin/menu.tmpl now uses admin/base.tmpl

=item *

cookie handling was broken in various annoying ways:

=over

=item *

the userid cookie didn't have a timeout

=item *

the change to the userid cookie wasn't
propagated to the secure side when the user logged out (or to the
non-secure side if they used a secure-side logout)

=item *

The wrong path was used when propagating the sessionid to the secure
side, making it almost completely pointless

=item *

The cart is now copied from the old secure side cookie, if any.

=back

=item *

admin users can now change their own passwords

=item *

the templater now supports a new type of conditional, a switch statement:

  <:switch:>
   text here is ignored
   <:case conditional-function1 conditional-args1:> result text 1
   <:case conditional-function1 conditional-args2:> result text 2
   ...
  <:endswitch:>

Each condition is checked in order.

A special:

   <:case default:>

always returns (and should always be last, since all conditions after
it are ignored.)

If there is no tag for the given condition-function on the page then
the text of the switch tag will be returned, hopefully to be replaced
by a second pass during processing of a pre-processed page (like the
checkout page.)

Hopefully this will reduce the need for nested ifs, but will probably
introduce it's own problems related to partially generated pages <sigh>.

Since the code attempts to do the innermost switch first it shouldn't
have nesting problems for complete pages, but may have some when a
page is partially generated, like with the shop and search templates.
If this becomes a problem I'll add a version with 'names' to act as a
nesting aid, but it will be ugly.

=item *

you can now manage site global images, accessible with the gimage[]
tag from body text, and the <:gimage name ... :> from templates

=back

=head2 0.13_03

Make sure you update your config file.

=over

=item *

custom templates may choose not to set the keywords field, this could
cause makeIndex.pl to complain about undefined values.  makeIndex.pl
now skips indexing NULLs.

=item *

BSE::Request's url() method was HTML encoding when it should have been
URI encoding.

=item *

the distributed menu.tmpl now includes menu_custom.tmpl for local
customization.

=item *

you can specify where under the site tree an article and it's children
will be stored using the [article uris] section of bse.cfg

=back

=head2 0.13_02

Another development release.

Please play with this and consider how named images and automatic image
placement should interact.  Should using a named image:

=over

=item *

completely suppress automatic image placement?

=item *

suppress placement of just the used named images?

=back

Or should named images never be automatically placed, with no effect
on automatic placement of other images?

Changes from the last release:

=over

=item *

0.13_01 shipped an out of date mysql.str file

=item *

the spacer <img> tag used to align arrows now has the alt value set
(to the empty string, since it has no semantic meaning) (#262)

=item *

the new formatting code was missing a library include

=item *

the body image[] tag wasn't suppressing automatic image placement (due
to the replacement of the body formatting code.)

=item *

adding an image was requiring an image name (it shouldn't)

=item *

the title for the image wizard help file was "Files Wizard".

=item *

added test script for the [] tag parameter processor

=back

=head2 0.13_01

Time to get a little adventurous.

=over

=item *

images can now have an identifier associated with them.  This can be
used by the body text image[] tag to reference an image by name.

=item *

the C<< <:imagen >> I<imagename> I<alignment> I<rest> C<< :> >> tag
can be used to insert images by name.

=item *

body text formatting is now based on the DevHelp::Formatter module.

=item *

b[], i[], tt[], font[], fontcolor[] over paragraph breaks are now
closed properly at the paragraph breaks.

=item *

newlines within pre[] are no-longer converted to paragraph or line
breaks.  As a consequence of this you can't nest character formatting
within each other within pre[text], ie pre[b[foo]] is ok, but
pre[b[i[foo]]] won't work.

=item *

the width and height parameters to the hr[] markup weren't handled
correctly.

=item *

the row options to the table[] tag were inserted HTML escaped, so:

  tr[...
  bgcolor="black"|col|...
  ]

produced a tr tag like:

  <tr bgcolor=&quot;black&quot>...

=item *

list items in ** or ## lists are now closed with </li>

=item *

we now put newlines between lines and paragraphs in the output of
formatted text, hopefully this will make it easier to read the source.

=item *

<:error_img:> now accepts a [...] format expression to get the field
name

=item *

the <:recipient_count:> tag is now available on the subscription
listing page.  This is used for display, and to hide the Send option
if the subscription has no recipients.

=item *

it's now possible to format the output of the subscription send
process by changing the C<admin/subs/sending.tmpl> template

=item *

if an article has an image with an identifier of C<bse_title> then it
will be used as the title image for the article.

=item *

you should be able to use one level of nested [] inside [] expressions
in tags now

=back

=head2 0.13

No changes since 0.12_31.

=head2 0.12_31

Hopefully this will become 0.13.

=over

=item *

selection of archive parents for subscriptions is now even more
strict, now you can't select the shop or catalogs as archive parents

=item *

eliminated debug output from the <:include ...:> meta tag

=item *

the move.pl C<r> parameter no longer pre-prepends the base url.

=item *

eliminated some undefined value and non-numeric value warnings

=item *

push "Flags" on the article edit page back into place

=item *

the top-level <:movecat:> tag in the product list now accepts the
custom arrow prefix and the url suffix parameters

=back

=head2 0.12_30

=over

=item *

the refresh function for the subscriptions list wasn't including the ?
when adding a message parameter

=item *

the order_detail target now accepts an C<m> parameter to set the new
<:message:> tag (which allows <:ifMessage:> too)

=item *

each of the targets in shopadmin.pl that accepted a message for
display through the C<message> parameter will now I<also> accept that
message through the C<m> parameter

=item *

the C<msg> tag is no longer available on the report system pages.  Use
the C<message> tag instead.

=item *

C<move.pl> now accepts the refresh URL through the C<r> parameter as
well as through the C<refreshto> parameter.

=item *

the list of possible parents for archiving a subscription now only
includes articles the user has permission to add children to.  This is
also validated on saving/adding the subscription.

=item *

check that the user has rights to add children to the selected archive
parent on sending the subscription

=item *

a confirmation message is supplied when refreshing after saving
changes to an existing subscription, or deleting a subscription

=item *

disabled some debugging code in the subcription send code

=item *

removed old code from shopadmin.pl

=item *

you can supply a refresh to url using the C<r> parameter to actions in
subs.pl to override the default refresh back to the subcriptions list

=item *

all generated C<img> tags now use a XHTML closing " />".  The space is
prevent problems with older browsers.  If you find a generated img tag
I've missed, please open a ticket.  C<img> tags in template might
still not be XHTML compatible, this isn't a bug.

=back

=head2 0.12_29

=over

=item *

makeIndex.pl now redirects directly to menu.pl rather than to /admin/
after rebuilding the index

=item *

added the "Don't index even if listed" and "Don't index this article
or it's descendants" flags

=item *

the custom session hash is now supplied to the order_save() custom
hook

=item *

the product tag on the cart pages now checks for undef values to
prevent warnings

=item *

field names in the validation messages produced by subs.pl now have
the first letter upper-cased.

=item *

creating a subscription now mentions that it's successful

=item *

the experimental report.pl compiles

=item *

added line-breaks between article flags on the edit pages

=item *

the image and file lists are now accessed using the default target in
add.pl.  Use _t=img and _t=file to access the lists now.

=item *

admin/edit_2.tmpl through admin/edit_5.tmpl are no longer distributed,
all normal article editing now use admin/edit_1.tmpl.  If you need
different pages for different levels remove the mappings from the
[templates] section in bse.cfg

=item *

the C<order_detail> target in shopadmin.pl now accepts a message
parameter

=item *

the edit_add_child security check will now fail if the article is a
product or if the article is too many levels deep to have a child.

=back

=head2 0.12_28

=over

=item *

the adduser and addgroup forms have been split off into their own
pages

=item *

the a_saveuser and a_savegroup targets for adminusers.pl now supply
the _t parameter passed to them to their default refresh targets.  The
_t parameter must only contain letters and digits.

=item *

the orders iterator for the order_list target in shopadmin.pl now uses
a generated iterator, so tags like <:order_count:> are now available.

=item *

the page specific date and money tags (<:date order_field:> and
<:money order_field:>) are no longer available on the order_list
pages, use the general date and money tags (<:date tag args:> and
<:money tag args:>).

=back

=head2 0.12_27

=over

=item *

added <:error_img:> support to the logon form (IRC request)

=item *

the <:childtype:> tag is now available on user/group permissions pages
which control access to articles (IRC request)

=item *

new tags <:add I<number> I<number>...:>, <:concatenate I<string>
I<string> ...:>, <:match I<string> I<regexp> I<output> I<default> :>,
<:lc I<string>:>, <:uc I<string>:>, <:lcfirst I<string>:>, <:ucfirst
I<string>:>, <:capitalize I<string>:> and <:replace I<string>
I<regexp> I<with> I<global>:> now available everywhere.

=item *

the code to parse [...] and "..." parameters for tags now passes
through backslashes (\) not followed by " or another \ inside "...".
This makes it easier to enter a regular expression in "...".

=back

=head2 0.12_26

=over

=item *

Dynamically generated templates that don't explicitly define an
<:old:> tag now have a new <:old:> tag by default.  Usage:

  <: old I<field> :>
  <: old I<field> I<func> I<args> :>

If a cgi parameter called I<field> has been supplied it will be
returned, otherwise an existing function I<func> is called with
I<args> and that value is used as the value of the <:old:> tag.

Returns an empty string if no CGI parameter I<field> or function
I<func> is defined. (#235)

=item *

userlist.tmpl and grouplist.tmpl now include appropriate

  value="<:old I<foo>:>"

tags

=item *

the "Your system has no groups" message in grouplist.tmpl did not span
across enough columns

=item *

the <:typename I<which>:> and <:articleType:> tags now work on the
user/group permissions pages which control access to articles. (#235)

=item *

the C<crumbs> iterator now works on user/group permissions pages which
control access to articles (#235)

=item *

<:error_img:> is now available on the userlist/grouplist templates for
displaying errors in adding a new user/group. (#235)

=item *

#235 mentions a problem with the <:cgi:> tag - could not reproduce

=item *

most save/add functions in adminusers.pl should now accept an C<r>
parameter to override the default refresh location (#253)

=item *

a save of an empty administration user name was being ignored, the
empty name is now saved (#250)

=item *

the name of a administration group can now be changed (#251)

=item *

quotes surrounding the URL in Refresh headers have been removed (#232)

the Refresh header is only briefly documented at 
http://wp.netscape.com/assist/net_sites/pushpull.html, and is not part of
the HTTP specification, so all I can do is guess.

=item *

entry of a blank release date when editing an article now results in a
validation error instead of a database error (seen as a 500 error)
(#240)

=item *

template admin/subs/list.tmpl checked the C<subs_edit> permission when
it should have checked the C<subs_send> permission when choosing to
display the B<Send> link.

=item *

subscriptions can now be deleted (#173)

=item *

experimental reports system added (work in progress)

=back

=head2 0.12_25

=over

=item *

admin/edit_product.tmpl had two <:error_img title:> tags

=item *

C<$SHOP_FROM>, C<$SHOP_TO_NAME> and C<$SHOP_TO_EMAIL> from
Constants.pm can now be overridden in the config
file. (C<[shop].from>, C<to_name> and C<to_email>)

=item *

the name of the custom class can now be specified in the config file
(defaulting to C<BSE::Custom>) (C<[basic].custom_class>)

=item *

you can specify an alternate library path to search for your custom
class (C<[paths].libraries>)

=item *

the custom class can now handle validate and store extra fields for
articles (and relates types, like products)

=item *

two custom date fields (C<customDate1> and C<customDate2>) and two
custom string fields (C<customStr1> and C<customStr2>) have been added
to the article table to allow simplfied customization.

=item *

the default article, product and catalog editing template now include
C<admin/custom_article.tmpl>, C<admin/custom_product.tmpl> and
C<admin/custom_catalog.tmpl> includes to allow adding custom form
fields without having to modify the main distributed editing templates

=back

=head2 0.12_24

=over

=item *

DevHelp::HTML, used to provide HTML and URI escaping wasn't including
a required module.  D'oh.

=item *

the keywords tag in the search page was being overridden by a tag of
the same name in the global article tags.  The old global C<keywords>
tag wasn't very useful and has been removed.

=item *

the templates drop-down in the subscriptions system included
duplicates

=item *

the crumbs iterator is now available on the article edit pages, and we
now present a path on the main edit page

=item *

you can now use <:crumb I<fieldname>:> to get to crumb article
information.  The current <:crumbs I<fieldname>:> will be obsoleted at
some point in the future.

=item *

the content of the help files no longer render as links in Mozilla

=item *

C<< <:typename I<which>:> >> tag added to the article editor pages

=item *

the list of articles available to page generation was in the wrong
order

=item *

when access control was switched off, links were displayed to permit
deletion of articles with children, when they shouldn't have. (#221)

=item *

Most article editor actions now accept an r parameter which can be
used to decide what happens after the action.  (#225, #226)

The save_new action adds an id parameter onto the end of the supplied
url if the r parameter is supplied.

=item *

more messages are included when the article editor successfully
performs an action (#225)

=item *

article editor and generator tags that generate arrows now take an
image prefix parameter which can be used to select alternate arrow
images.  A second parameter can also be used to add onto the refresh
URL to supply extra information to the refreshed to page. (#224, #225,
#226)

=item *

some code in BSE::Util::Tags was calling CGI::escapeHTML() at regen
time (#223)

=back

=head2 0.12_23

=over

=item *

the list of templates in the drop down on the article edit page didn't
reflect the local_templates config option correctlt.

=item *

validation errors weren't always reported (or acted upon) correctly

=item *

when an invalid product options string was stored a 500 error was
produced when generating the page

=item *

the image tag wasn't including a closing " at the end of the alt
attribute

=item *

the article generation code no longer relies upon CGI.pm functions for
escaping HTML, URIs or producing product option popups, this should
make it possible to use gen.pl from cron jobs without getting prompts
for CGI parameters

=item *

catalogs had two buttons labelled "Add product", but one added
catalogs.  Relabelled the one that adds catalogs to "Add Sub-catalog".

=item *

the ifnew tag on edit templates is no longer available, use ifNew
instead (this was true as of 0.12_22)

=item *

added a flags field to articles, this is used for both BSE internal
flags and for site specific flags.

=item *

the search index builder will now only index articles that are listed,
or have the "Index even if hidden" (I) flag set.  Changed the simple
search test to search for a non-hidden article.

=item *

the title field of all articles are now validated to include at least
one non-space character

=item *

validation failures on images and files are now available via the
error_img tag

=item *

the move image up/down action on the images manager were refreshing to
the wrong page after reordering the images

=item *

changed default level names in Constants.pm and bse.cfg

=item *

changed tests to use the new level names

=item *

templates admin/subs/add.tmpl and admin/add_product.tmpl have be
consolidated into their edit versions

=back

=head2 0.12_22

=over

=item *

added iterator allkids_of to iterate over the children and
stepchildren of a given article.

=over

 <:iterator begin allkids_of I<parent_id1> ...:>
 <:ofallkid I<field>:>
 <:iterator end allkids_of:>

=back

=item *

when you clicked send from the subscriptions list the archive parent
field wasn't being set from the value set when adding/editing the
subscription

=item *

generate_search() wasn't supplying a config object when creating the
article generator.  This caused problems when some article types were
embedded within the search page.

=item *

added mailing list info

=item *

$TMPLDIR is no longer present or used in Constants.pm.  Use templates
in the [paths] section of the config file.

=item *

The path specified by the local_templates entry in [paths] is now
searched for templates before the path specified by the templates
entry in [paths].  This can be used to keep locally modified versions
of templates separate from the distributed templates.

=item *

reordering arrows now display a filler image where there's a single
missing arrow image (at the top and bottom of the list).  No spacer is
displayed if there's a single item.

=item *

added tt[text], pre[text], h1[class|text] through h6[class|text],
class[class|text] tags to the body text formatter.  Paragraphs are now
closed by the body text formatter.

=item *

added a few more tests

=back

=head2 0.12_21

=over

=item *

template change from adrian (edit_steps.tmpl):

Finally fixed something that has bugged me for a while... I simply 
moved the "if Kids" conditional to include the note about "Delete 
only removes the stepkid relationship..." since not much point in 
showing that is no step kids available... the step parent panel 
already did this.

=item *

printable.pl now attempts to look for a content type for a given
template.  This can be used for different types of presentation, for
example WAP.

=item *

printable.pl now uses the configured charset if set.

=back

=head2 0.12_20

=over

=item *

the change to using HTML::Entities cause CR characters to be encoded
when written to the browser.  This causes some browsers some
confusion.  The article and product tags in BSE::Edit::Article and
BSE::Edit::Product now remove these before output.

=item *

if a ## or ** list didn't have a final newline the final item wasn't
included in the conversion to a HTML list

=item *

some new templates from Adrian

=item *

Adrian added some more default user level permissions

=back

=head2 0.12_19

=over

=item *

article matching for global permissions was still broken.  The change
broke access to the descendants flag, but it all seems to be working
now.

=item *

forgot to include access.pod in the MANIFEST. Added it.

=item *

added descriptions of the step child/parent permissions to access.pod

=item *

the possible stepparents drop-down checked if the possible stepparents
could have children, but didn't check if the current article could
have stepparents.

=back

=head2 0.12_18

=over

=item *

article and global permissions should now be listed sorted by their
identifier

=item * 

the not and descendants flags were being ignored on global permissions

=item *

stepchildren and stepparents had no access control at all, now they
do.  Note that you may sometimes get a save button on the step
parent/children page with no fields to edit - this means you have save
rights on the current article but not on any of the listed step
children/parents.

=item *

fixed shopitem template from Adrian

=item *

more navigation links in the user/group management pages

=back

=head2 0.12_17

=over

=item *

the logon processing code was calling the logon processing code rather
than the logon form code on a failed logon.  This cause infinite
recursion.

=item *

removed the pointless Admin menu link from the logon form

=item *

add.pl was producing a warning when called without an id parameter

=item *

generate.pl didn't refresh properly if the user didn't have permission
to regenerate

=item *

the menu now only shows the regenerate options if the user has
permission to do so

=item *

move.pl (used to handle the reording arrows) didn't even compile

=item *

the hide/show links on the product detail page pointed at the wrong
place, and were still shown if the user didn't have the rights to do
the job.

=item *

the edit_product template displayed the hide/show link even if the
user wasn't permitted to do so

=item *

new templates from adrian to hardcode the text color in the file lists
on article pages

=back

=head2 0.12_16

=over

=item *

the ifUserCan tag wasn't converting article names into numbers
correctly

=item *

a few pages didn't supply the article parameter to ifUserCan correctly
(or at all in some cases)

=back

=head2 0.12_15

=over

=item *

global permissions simply didn't work, due to a dumb bug

=item *

the user/group admin pages now display buttons and checkboxes more
intelligently, depending on the user's rights

=item *

the user/group save processing was trying to call an undefined method
if the user didn't have access to a function.  As was the add form in
add.pl if there wasn't an article the user could add to at the given
level

=item *

the hide/unhide links on the edit_product page pointed at the wrong
place.

=item *

image, file, stepchild and stepparent changes now regenerate the
article (depending on the auto generate flag in Constants.pm).  You
will probably want to do a site regen when you're done still, since it
only regenerates the article you're working with, not it's
stepchildren and step parents.

=item *

link the edituser and editgroup help to the adduser and addgroup help
files respectively and add entries for the groups and members field
respectively.

=item *

added a help file for the access panel help icon to link to.

=back

=head2 0.12_14

=over

=item *

product_detail.tmpl hadn't been converted to use the global money tag

=item *

different versions of CGI::Cookie use different default paths, we now
force a path of "/".

=item *

really store the date and _time_ in the order date.

=item *

if the system needs you to logon for checkout, it now supplies the
correct parameter to the logon code to return you to the checkout
after you logon.

=item *

when setting configuration values from test.cfg with the:

I<section>.I<key> = I<value>

syntax, I<section> can now have spaces in it.

=item *

added some basic permission descriptions, and documentation on the
permissions system

=back

=head2 0.12_13

=over

=item *

the title field could be changed on products that had been ordered (an
edit field was presented for the summary field, but wasn't saved)

=item *

edit_0.tmpl had two manage access forms on it

=item *

use the new system logon rather than just checking for a browser
authentication userid, when marking an order filled.

=item *

attempt to account for differences between what browsers send us for
text areas (currently only for the body)

=item *

prevent <br> between each element of a <ol> or <ul> list, and try to
prevent one after the end.  Double spaced entries in a list are now
followed by <br>s to make it easier to do spaced out lists.

=item *

new hide and unhide targets for add.pl to make the links in the
product list work again

=item *

the save target for existing articles in add.pl now checks the user is
allowed to do it.

=item *

the product link on the final checkout page was broken (adrian)

=item *

the reordering links were displayed on the shop index page with the
multicat template

=item *

the query used to retrieve user, group and everyone permissions from
the database was broken.  Broke it into three separate queries.  I
wish mysql supported unions

=item *

you can now logout if you logged in using the form based logon

=item *

creating a user, saving an existing user or deleting a user will now
create an apache suitable user file, if the htusers field in [basic]
is set.

=back

=head2 0.12_12

=over

=item *

mysql_build.pl wasn't cleaning up old tables, and since we use it for
two different projects, the tables from another project were being
included.

=item *

annoying and numerous warning from Squirrel::Template eliminated

=item *

change admin.pl to check the admin user is logged on

=item *

change generate.pl to check the admin user is logged on and has the
access needed to regen

=item *

change move.pl to check the admin user is logged on and has the rights
to perform the move requested

=item *

change reorder.pl to check the admin user is logged on and has the
rights to perform the reorder requested

=item *

change shopadmin.pl to check the admin user is logged on and that they
have the rights needed to perform the requested operation

=item *

change subs.pl to check the admin user is logged on and that they have
the rights needed to perform the requested operation

=item *

BSE::Permissions::user_has_perms() now accepts an article id,
simplifying some code

=item *

added orderfiles iterator to the userpage.

=item *

updates to BSE::Edit::Article to only allow movements when the user
has appropriate rights

=item *

field change permissions



=back

=head2 0.12_11

=over

=item *

thumbnails are now saved when editing an existing article

=item *

the code to save keys to config sections which didn't already exist
was broken

=item *

the total_extras custom hook now takes two extra parameters, the
config object and a "stage" of processing, either "cart", "checkout",
"confirm" or "final".

=item *

new customization hook order_mail_actions($order, $items, $products,
$state, $cfg) for adding extra tags to the confirmation and order
emails.

=back

=head2 0.12_10

=over

=item *

pass the configuration object to each BSE::Custom method

=item *

new shop target, "checkupdate" intended for updating information on
the checkout page for customizations

=item *

you can now set extra configuration items in test.cfg using 

I<section>.I<key> = I<value>

(Adrian asked for this a while back.)

=item *

dynamic menu display

=item *

logon page (only seen if access control is enabled)

=item *

start of access control

=back

=head2 0.12_09

=over

=item *

ability to control permissions each admin user and group has access to

=item *

new help for image manager, other updated help files, many template
changes, thanks to Adrian.

=item *

deleting admin users and groups

=item *

selectable payment types

=item *

when sending a subscription with HTML content, the boundary between
MIME parts has been changed to hopefully prevent problems with some
mail clients

=item *

when sending a subscription with HTML content, any carriage-returns
are converted into linefeed to hopefully prevent problems when sending
subscriptions based on Macintosh format files to some mail clients.

=item *

htmlemail/basic.tmpl now includes a DOCTYPE, which will hopefully
prevent problems with some mail clients.

=item *

conditionals are now handled differently in the templating system to
avoid some of the undefined value warnings it was producing.

=item *

added fields intended for custom processing to the orders table

=back

=head2 0.12_08

This is a development release.  If you want stable try 0.12_01, since
many destabilizing changes have occurred since then.

If you install this release it's possible the upgrade_mysql.pl script
cannot be used to upgrade to a later release.

=over

=item *

oops, forgot to implement deleting articles, so I implemented it for
articles and unused products

=item *

you can now add admin groups and users.  This is in progress and the
templates and code still need work.

=item *

image files weren't being deleted when an image was deleted from an
article.

=item *

the page refreshed to the normal article edit page after deleting an
image, it should refresh to the image list

=item *

updated and new templates and new file icons from Adrian

=back

=head2 0.12_07

=over

=item *

added handling for a default template based on parent, level and type.
Returns to our original defaults from %LEVEL_DEFAULTS, but uses the
config file instead.

=item *

now lists level specific templates in the templates drop-down for
normal articles

=item *

updated templates from Adrian

=item *

since the default release date for new products is now the date the
product was added, and release is a datetime, add_item()'s check to
make sure the product had been released was broken, since it only
compared it with a date.

=item *

the purchase() and prePurchase() functions in shop.pl had a similar
problem

=item *

articles weren't being regenerated on save

=item *

report errors supplied to show_cart() in shop.pl

=item *

changed add_item() to report why it didn't add an item to the cart via
show_cart() (#167)

=item *

t/t00smoke.t now checks add.pl for normal articles, catalogs and
products

=item *

removed now unneeded onClick handler from delete in the image manager

=back

=head2 0.12_06

This release includes some inactive files for access control.

=over

=item *

replace edit_2.tmpl (which replaces edit_[345].tmpl) too

=item *

fix a dumb bug that prevented changes to the base article fields from
being saved

=back

=head2 0.12_05

=over

=item *

test script to check that all modules and scripts have use strict and
all scripts have -w in the #! line

=item *

the width and height values were swapped for display of an articles
images in the image manager template

=item *

children weren't sorted on article editing pages

=item *

updated templates from Adrian.

=item *

added a previousLogon field to accept the last value of lastLogon at
logon, so the previous value could be displayed.

=item *

editing an article would give a server error on save (due to some late
changes)

=back

=head2 0.12_04

=over

=item *

the wrong url was redirected to after adding a new image or saving images

=item *

manage catalogs now points back at shopadmin.pl

=item *

removed the "Image Wizard" buttons and replaced them with "Manage
Images" links in the image displays. (and fixed some missing </td> tags)

=back

=head2 0.12_03

=over

=item *

added child_types() method to BSE::Edit::Product so it knows what
child types a product can have.  This meant that the Add Product
button on the view in edit page was trying to add a normal article
rather than a product.  Typically a type parameter should be supplied
when creating new articles which aren't base articles.

=item *

shopadmin.pl was still using $imageEditor even though it wasn't
defined

=item *

t00smoke.t wasn't checking shopadmin.pl

=item *

edit_[1-5].tmpl and edit_catalog.tmpl included the starting <form> tag
in a conditional, breaking the form when creating a new article

=back

=head2 0.12_02

When installing this release over earlier releases:

=over

=item 1.

run mysql_upgrade.pl to upgrade the database schema

=item 2.

start the mysql shell and run the following query in your database:

  update image set displayOrder = id;

to preserve image ordering.

=item *

the <:if art:> conditional tag is no longer available

=back

This is a development release, intended to test the new code in BSE,
in preparation for adding security mechanisms.  This is not intended
for production use yet.

Please see the known problems list.

=over

=item *

was parsing wrap parameters when there weren't any, which caused
warnings in the error log

=item *

you couldn't create a new subscription with the archiving switched off

=item *

if you edited a subscription, and unset the archive check, the save
left it as archived.

=item *

article editing is being almost completely rewritten to allow more
code re-use.

=item *

article image management has been completely rewritten so that the
changes you make are immediate, rather than relying on the user to
save the article after making changes.  This prevents the problem that
sometimes crops up where the images you're editing are for the wrong
article, or left over from an aberted attempt to create a new article.

This change also means you can't add images to an article until the
article has been created.

=item *

previously the order of images would change at the whim of the
database, which happened pretty rarely but still happened.  Added a
displayOrder field to images, and we base the ordering (and
re-ordering) on that instead of whatever the database chooses to give
us today.

=item *

products and catalogs use the new editing code

=item *

new tags on edit pages to give access to validation errors (most
noticable on the add product page for now),

=item *

added an "old" tag to take a value from either the cgi parameters or a
given other tag.  This makes error reporting more natural

=back

Known issues:

=over

=item *

the code allows the product title and summary to be changed.  The new
security code will correct this (and allow them to be changed, or the
product to be deleted, for unused products)

=item *

only add_product.tmpl has the new error reporting and old value access
tags

=item *

the delete/undelete links for products don't work.  Currently the same
functionality is available through the Listed drop-down, but it might
be desirable to keep the links, comments welcome.

=back

=head2 0.12_01

Some derived tags may not work with the new fields, since I've
switched to the version of Squirrel::Template used by Resource, which
should reduce memory consumption a little, once all the tags are
converted.

I think I have all the derived tags, but there might be one I
missed...

=over

=item *

added ifAncestor conditional tag

=item *

added iterator children_of and tag ofchild, usage:

=over

<:iterator begin children_of I<parent_id1> ...:>
<:ofchild I<field>:>
<:iterator end children_of:>

=back

=item *

added iterator inlines and tag inline, usage:

=over

<:iterator begin inlines I<article_id1> ...:>
<:inline I<field>:>
<:iterator end inlines:>

=back

=item *

more test code to test the above (now I have the infrastructure to
simplify adding these types of tests

=back

=head2 0.12

0.11_21 seems stable enough.

=head2 0.11_21

Assuming no other problems are found this will become 0.12

=over

=item *

oops, missed some updated templates from Adrian, applied bse_changes
archive (#148)

=back

=head2 0.11_20

=over

=item *

another set of new templates from Adrian

=item *

extended title and email fields of site_user to 127 and 255 characters
respectively

=back

=head2 0.11_19

=over

=item *

remove debugging code from Generate::excerpt() (#142)

=item *

added script interest.pl to send an email to the site owner when the
user registers interest in a product (#133)

=back

=head2 0.11_18

=over

=item *

must_be_filled really fixed now (#128)

=item *

was calling function (now_sqldatetime()) that didn't exist

=item *

integrated new templates from Adrian, hopefully I got the right
revisions.

=item *

<:moveallprod:> for the catalogs page (#122)

=item *

admin link for new catalogs now points at admin.pl (#120)

=back

=head2 0.11_17

=over

=item *

removed extraneous <:embed end:> from printable.tmpl

=item *

prevent access to parent fields from autovivifying $parent in
Generate::Article::baseActs(), which caused ifParent to return true.

=item *

gen.pl now enables the query cache even for small batches, since it
makes a big difference.

=item *

products pages now remove the <:embed start:> and <:embed end:>
markers

=item *

need a space between "checked" and the closing "/>" in
options_base.html for the checked to be recognized.

=item *

keepAddress stayed checked once checked

=item *

must_be_filled is now correctly looked up in [downloads] - it was
looking in [download] (#128)

=item *

prevent a warning about using a regexp range of [\w-.] by making it
[\w.-] (BSE::UserReg)

=item *

store the date _and_ time in the orderDate field so that orders are
sorted correctly on the user page. (#132)

=item *

add sort order after date to sort by id descending for orders on the
same date (#132)

=item *

highlight multi-word matches in search excerpts (#125)

=item *

help for body text from add product page (#118)

=item *

new templates from Adrian

=item *

when creating a new product, the release date was being set to
2001-01-01, rather than the more useful C<today> (whatever day that
happens to be).  This was mostly visible to the search engine. (#130)

=item *

images list now available on edit_product.html page

=back

=head2 0.11_16

=over

=item *

updated templates from Adrian (which I forgot to add in 0.11_15
<sigh>)

=back

=head2 0.11_15

=over

=item *

moved step kids/step parents management to their own page (if you use
the old edit templates you can keep them on the same page.)

=item *

added file_unlink option to [debug] in bse.cfg

=item *

added mail_encryption option to [debug] in bse.cfg

=item *

minor reorganization of mail encryption to avoid a "Odd number of
elements in hash assignment" error in some circumstances.

=item *

added help to the article editor pages

=item *

added license

=item *

added <:movestepkid:> tag to the Generate::Article set of tags

=item *

added the BSE::Version class and the <:release:> tag

=item *

more admin templates (most of the edit_*.tmpl) can now be controlled
from the config file.

=item *

fixed a broken in-page link from the refresh after adding a stepparent

=item *

fixed an uninitialized value warning introduced in 0.11_14

=item *

changed the misleading "Uploaded files" to "Uploaded images" on the
edit pages.

=back

=head2 0.11_14

=over

=item *

imageclean.pl now keeps thumbnail images

=item *

new display templates from adrian

=item *

added the stepkids and allkids options to ifUnderThreshold.

=item *

documented the C<kb>, C<date>, C<ifEq>, C<ifMatch> and C<cfg> tags.

=back

=head2 0.11_13

This is a test release.

=over

=item *

added the kb tag which formats the result of it's arguments with a k
suffix if the value is over 1000.  This can be used for making file
size displays prettier.

=item *

the config variable wasn't being passed into the ImageEditor object in
shopadmin.pl

=back

=head2 0.11_12

This is a test release.

=over

=item *

make the downloadable files feature available on other pages

=item *

add code to support downloads of non-paid for files

=back

=head2 0.11_11

=over

=item *

make the url tag generate the full url on "extra" pages.

=back

=head2 0.11_10

=over

=item *

test.cfg now has a C<securl> option to control the configured secure url

=item *

added site/doc/secure.pod, describing security considerations

=item *

article title field has been extended to 255 characters.  The title
edit field maximum length can be controlled with the C<title_size>
item in [field] in F<bse.cfg>.

=item *

you can get access to the currently logged in user on the checkout and
cart pages using the C<ifUser> conditional tag and the C<user> value
tag.

=item *

stripped some more common code out of shop.pl

=item *

extended the common cfg tag to take a third default value parameter

=item *

search result excerpts can now bold partial matches 

=item *

the page regenerator didn't handle the case where a port name was
present in the secure url.

=item *

now generate gen.html from gen.pl

=item *

added POD to site/docs/makedocs and generate the HTML

=item *

added POD to site/util/upgrade_mysql.pod and generate a HTML version

=item *

when a user logs on and the secure url is different from the base url,
BSE now refreshes to the other side of the site to set the same
session cookie there.  This allows session information to be shared
with the two sides of the site.

There is a known issue with this: any session information (like the
shopping cart) stored on the other side of the site is not retained.

=back

=head2 0.11_09

=over

=item *

updated user/* templates from Adrian

=item *

checkout code for the shop didn't pass in the config object to the
mail class

=item *

work around a bug in the search index builder

=item *

finally added some test code.  This isn't ready for general use yet and
could damage your system.  So don't use it.

=item *

BSE::Cfg now checks the current directory as well as $FindBin::Bin,
this lets initial.pl work

=back

=head2 0.11_08

This is a test release.

I still need to integrate some of the customization hooks from the
realware branch.

=over

=item *

remove dependency on Time::HiRes (this was used for benchmarking while
speeding up the site regen.)

=item *

the global date tag didn't handle a date where the time was missing
(like article.lastModified).  And it ignored the time when it did
manage to extract it.

=item *

remove query caching change reports (Table.pm)

=back

=head2 0.11_07

This is a test release.

=over

=item *

initial.pl now looks at the config file for the secure base url

=item *

BSE::Util::Secure wasn't importing md5_hex

=item *

added missing user/email_conferror_base.tmpl

=item *

the user/confirmed.tmpl entry was missing from [pregenerate] in the
supplied bse.cfg.  Also user/email_conferror.tmpl

=item *

the randomdata key was missing from the [basic] section in the
supplied bse.cfg

=item *

changed message in site/templates/user/toosoon_base.tmpl to prevent
panic when the user goes back and selects another group

=item *

changed meaning of ifUser in user templates to accept a parameter if
present

=item *

updated user/options_base.tmpl to display email confirmed information
a bit more correctly

=item *

the admin can choose to hide some subscriptions

=back

=head2 0.11_06

This is a test release.

I wouldn't be suprised to find problems in this release, there have
been a lot of changes.

Still needs some documenting.

=over

=item *

optimized generate_all() for large sites.  Despite the fact most of
the improvement came from caching, generate seems to use less memory.

=item *

added gen.pl command-line regen script

=item *

added option to generate.pl to just regen extras and base pages

=item *

$URLBASE and $SECURLBASE from Constants.pm have been moved to C<url>
and C<secureurl> in the C<[site]> section of bse.cfg

=item *

datadump.pl now uses the newer database configs (has it worked
recently?) and the newer mail interfaces.

=item *

subscriptions management - interfaces to add new subscription
(newsletter) types, and displays options in user options to allow a
user to subscribe.  To prevent abuse by spammers (maybe) and by other
attackers, we get the user to confirm subscription of their email
address.  This is big.

=item *

%EXTRA_TAGS has been moved to C<[extra tags]> in bse.cfg

=back

=head2 0.11_05

This is a test release.

=over

=item *

added base_tags() to BSE::Custom (tags available during static
generation of most pages.)

=item *

step(kids|parents) now available to all articles, though you may have
some problems connecting the shop articles (catalogs,products) to
others

=item *

standard date tag available in most places

=item *

the <:summary:> tag now takes an optional which parameter, defaulting
to "child".

=item *

you can now specify the default template for children of a given
article.

=item *

you can specify extra template directories to search while editing a
given article.

=item *

moved the side bar logon form to it's own article (loaded by
initial.pl) and added it to the side bar subsection.

=item *

shortened the long message used in the refresh back to user.pl when
the user has file based products in their cart, but hasn't logged in.
This was causing problems with IE6.  It now attempts to pull a longer
message out of the config file.

=back

=head2 0.11_03

=over

=item *

handling of downloads from the user page is handled better: you don't
get a download link unless the file is downloadable, and rejected
download results in a refresh to the user page rather than just
displaying the user page

=item *

the logon and register pages can now be passed a refresh url, which
the shop uses when it refreshes to the logon page

=item *

add an orders button when logged in

=item *

the file list was messed up

=back

=head2 0.11_02

Another test release:

=over

=item *

actually tested the form filling with the user's defaults

=item *

modify localinst.perl to remove the default bse.cfg

=item *

have the checkout function return if the user needs to register (shop.pl)

=item *

check in a few more places if the user needs to register (shop.pl)

=item *

changed names of fields in SiteUsers to match the checkout form

=item *

added telephone and facsimile fields to the user options

=back

=head2 0.11_01

Test release:

=over

=item *

supports files attached to products for sale

=item *

user registration

=item *

we now have a config file

=back

=head2 0.11

Looks like all known problems are fixed.  Time to do a semi-major
release.

=head2 0.10_16

=over

=item *

hopefully fixed an occasionaly problem where the images would reorder
themselves

=back

=head2 0.10_15

=over

=item *

make the depth parameter in <:embed which template depth:> work

=item *

give the sitemap a lower depth since 7 levels (5 + the level1 and 2)
is too much.

=back

=head2 0.10_14

=over

=item *

try to avoid dividing entered prices by 100 when there's an error on
the product edit/add form.  There's still some potential problems
here, but they're much less likely to cause a problem.

=item *

remove the border from image[] generated images

=item *

move the error message on the product add form so it isn't mixed up
with the menu

=item *

the dummy product used to generate the product edit form after an
error wasn't useful for getting step catalogs, get the real product
object just for that.

=back

=head2 0.10_13

=over

=item *

remove the border from embedded images with a url

=item *

fixed an old bug that defaulted the threshold from the template (oops)

=item *

the ... in <:image which align ...:> or <:image which field ...:> is
now appended to the attributes of the image field.  If it includes a
border attribute the default border attribute is suppressed.

=back

=head2 0.10_12

=over

=item *

new order_list templates from adrian (moved the filter forms into the table)

=item *

fixed the image wizard for products.  I'm suprised this ever worked.
Wasn't preserving parentid when creating a new product.

=item *

new edit_product template from adrian

=item *

stupid bug in BSE::Shop::Util

=item *

email is now in BSE::CustomBase->required_fields() and can be removed
by BSE::Custom->required_fields().  If it is removed then no
validation of the email address is performed.

=item *

state changes made in handling the confirm page are now saved

=item *

added strict to a few modules

=item *

added missing error handling methods to BSE::Mail.

=item *

old tag on the confirm tag now never gives the undef value message

=item *

if you specify a embedding depth less than the current maximum, you
won't get an error message embedded when passing that depth.  This
lets you do more interesting effects.

=item *

shop.pl now writes mail sending errors to STDERR (to the error log on
apache) rather than aborting the order display (since the order
actually exists at this point.)

=back

=head2 0.10_11

=over

=item *

support for filtering the order lists by dates entered by the user

=item *

make the add section link work, and make the link itself a little more 
usable

=item *

removed some old debug code

=item *

make BSE::Custom->checkout_actions() work on the confirmation page

=back

=head2 0.10_10

=over

=item *

documented new tags for Product.pm and Article.pm

=item *

shopadmin.pl can list/move the stepkids (you can hide them too)

=item *

added some tests to test if various iterators show anything,
ifProducts, ifAnyProds, ifStepProds.

=back

=head2 0.10_09

=over

=item *

put the reorder links into the edit templates

=item *

fix expire labels for edit_1.tmpl and edit_catalog.tmpl

=item *

reordering from the catalog works

=item *

reordering from the product editor works

=back

=head2 0.10_08

Making progress.

=over

=item *

fixed the ordering of items in the allprods tag

=item *

make allprods always work with products

=item *

realware wanted a confirmation page

=back

=head2 0.10_07

Another test release:

=over

=item *

initial step kids|parents for the shop

=item *

new popup menu templates from Adrian

=item *

added acknowledgements to AUTHOR section

=back

=head2 0.10_06

Test release for Adrian, with his new templates.

=head2 0.10_05

Test release for Adrian.

=head2 0.10_04

Don't use this version.

=over

=item *

URLs can be directly associated with an image

=item *

multiple levels of catalogs

=item *

shop item options

=item *

filtering/sorting of orders from the template

=item *

embedded templates can be based on the template of the article being
embedded

=item *

order status information, marking an order has having been filled

=item *

better handling of generation errors

=item *

partial support for Microsoft SQL Server under IIS

=item *

extended price tag for the cart and checkout pages

=item *

prePurchase target for the shop, to allow custom credit card processing

=item *

template based filtering of the order list

=back

=head2 0.10_03

=over

=item *

added the admin/reorder.pl script

=item *

template names in <: embed :> tags have $ replaced with the template
name of the article.

=back

=head2 0.10_02

=over

=item *

added the image[] tag  (image[index|align|url])

=item *

added printable.pl, site/templates/printable/printable.tmpl to allow
printable versions of pages (among other things)

=item *

implemented the ifCurrentPage tag

=back

=head2 0.10_01

=over

=item *

added <:siteUrl:> tag in %EXTRA_TAGS (used by the RSS templates)

=item *

fixed broken template value for the formatting guide (initial.pl)

=item *

fixed broken admin links for the formatting guide (initial.pl)

=item *

the formatting guide now generates to
http://your.site/a/format_guide.html (initial.pl)

=item *

RDF/RSS is now generated to /a/site.rdf.  This includes links and
titles for the articles on the home page, and a search field (if the
tool displaying the RSS supports that.)

=back

=head2 0.10

WARNING: the tag for articles found for a search has changed from:

  article I<field>

to:

  result I<field>

There is a new module required: HTML::Parser

=over 4

=item *

the <:embed child:> tags meaning has been expanded to allow embedding
of any article with an optional template

=item *

there's now an embed[] tag for use in body text.  Both this and 
<:embed ... :> are protected against infinite recursion.

=item *

changed display values for sections etc in Constants.pm, you can still
put your own in when you customize.

=item *

the default templates for each level have been set to a single
template, for a simpler default setup

=item *

new admin index pages, which may display a little better in some
browsers

=item *

you can move articles between levels, if enabled in Constants.pm

=item *

unquoted search terms will do "start of word" searches if enabled in 
Constants.pm

=item *

html[] tags and <html> body text now has tags stripped when displayed
as a summary or as a search excerpt.  The search indexing can now
handle both of these too.

=item *

the search template now uses 'result' rather than 'article' for the
search result entries.  This is needed since the search base page is
generated as an article, using a dummy article.  The title and
titleImage for this dummy article can be specified in Constants.pm.

=item *

you can now control whether an unlisted level1 article is displayed in
the crumbs for an article.  By default unlisted level1 articles are
NOT listed anymore.

=item *

a bunch of new templates from adrian, including moving the common
layout into base.tmpl where possible, support for "sidebars".

=item *

a formatting guide article in initial.pl (from adrian) (and then an
updated version of it)

=item *

renamed INSTALL to INSTALL.txt to prevent wierdness if someone tries
"make install" on a case-insensitive file system.

=item *

administration templates are now kept in the admin directory in the
templates directory

=item *

added simple test installer.  WARNING: this destroys the existing content
of your site.

=item *

distribution now includes site/htdocs/shop as a directory rather than
as a file

=item *

schema/bse.sql now drops the tables if they already exist

=item *

the item description in the shopping cart is now a link to the item

=item *

changed some defaults in Constants.pm

=item *

catalog templates from $TMPLDIR/templates/catalogs weren't being handled
correctly

=back

=head2 0.09

=over 4

=item *

added support for controlling access to the regenerate option

=item *

added the ability to disable auto-regeneration

this initially broke some buttons, fixed

=item *

properly escape child properties in add.pl

=item *

removing an article now removes any associated images

=item *

removing an image from an article now removes the image file when you
save the article.

=item *

added datadump.pl (send an email containing a mysql datadump), with
configuration in Constants.pm

=item *

added imageclean.pl - cleans up the image table and images directory

=item *

added an advanced admin page with links to datadump.pl and
imageclean.pl (you can change these of course).

=item *

previously it was possible for a user with admin rights to choose a
template that was outside the templates directory.  

=back

=head2 0.08

=over 4

=item *

modified administration templates

=item *

formatting is now stripped from body text before an excerpt is
produced (for the search results).

=back

=head2 0.07

I'll add in the 0.07 change list as soon as I figure out what I changed...

Once I get my old 0.08 RC that may include the 0.07 change list.

=head2 0.06

Some changes are being made to allow the engine to be embedded into a
site (specifically squirrelweb.com.au).

=over 4

=item *

Bug fix: shop.pl had a silly exporter mistake, and a sillier reference
to an unknown variable name.

=item *

changed admin links to buttons for the catalog and product pages,
added a Display button to the product page.

=item *

cleaned up the shopitem, cart_base, checkout_base, checkoutfinal_base,
mailorder and mailconfirm templates, removing tags that don't work in
them, removing references to bodyscoop, fixing broken images, removed
thawte stamp.gif.

=item *

%EXTRA_TAGS now work in mailorder and mailconfirm templates

=item *

You can now use $SHOP_EMAIL_ORDER to disable sending the encrypted
order.  (Useful only for testing or until you get encryption keys
organized - there's no other way to get the credit card number and
expiry date.)

=item *

Generate/Product.pm had a hard-coded link to the internal test
site. (Doh!)

=item *

some base URIs can be configured, though this still needs some work.

=back

=head2 0.05

=over 4

=item *

Bug fix: only add the class attribute to thumbnails if one is supplied
(doh!)

=item *

Moved shop configuration from shop.pl to Constants.pm

=item *

Extended template field to 127 characters so directories can be used
without chopping off names.

=item *

Added installation documentation.

=item *

Templates in the drop-down lists in add.pl now includes templates from
$TMPLDIR/$level and $TMPLDIR/common.

=item *

crumbs now include the section, whether or not they are listed.

=item *

added templates.pod, which contains most templating documentation,
copied from new documentation in various places (shop.pl, search.pl,
Generate::*.pm).

=item *

search.pl wasn't handling single-quoted search terms correctly

=item *

added ifInMenu tag

=item *

more changes to support multiple catalogs:

=over 4

=item *

the initial catalog can be removed.  The initial catalog isn't useful
when you need more than one catalog.  If you want multiple catalogs
you need to remove the initial catalog and then add new ones.  The
templates need work too.

=item *

the link/admin fields for the new article are set correctly (oops)

=item *

added a sample section template for a multi-catalog shop

=back

=item *

the sample templates look better, along with better title images

=item *

the shop was being generated with a non-secure url

=item *

parent articles were not being regenerated when an article was deleted

=back

=head2 0.04

You will need to recreate the articles table, since a new column has
been added to support article thumbnails.

=over 4

=item *

Added article thumbnails.

=item *

Multiple product catalogs.

=item *

leadTime is now modifiable in products.

=item *

Bug fix: only list .tmpl files from template directories in article
editing forms.

=item *

Bug fix: prevent adding non-catalog subsections to the shop section.

=item *

Bug fix: the crumbs iterator no longer shows crumbs that have "don't
list in menu" set.  Such subsections often shouldn't be linked to.

=item *

The documentation on article templates has been improved.

=item *

Some tags that operate on articles have been expanded to work on all
article objects available in the template.

=back

=head1 AUTHOR

Tony Cook <tony@develop-help.com>

I originally wrote BSE while an employee at SquirrelWeb
(http://www.squirrelgroup.com/) for one of VisualThought's clients,
bodyScoop.com (http://www.bodyScoop.com.au/).

Most of the BSE templates were created by Adrian Oldham of Visual
Thought Communications (http://www.visualthought.com.au) He also
funded and suggested many improvements.

Realware Systems (http://www.realware.com.au/) funded the nested
catalogs, IIS support, the image access tags, and many other shop
improvements, including most of the BSE::Custom hooks.

=cut
